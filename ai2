å¤ªæ£’äº†ï¼Œåœ°åŸºæ‰“å¾—éå¸¸ç¨³ï¼
ç°åœ¨æˆ‘ä»¬è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼Œæ„å»º**â€œğŸ·ï¸ æ ‡ç­¾ä¸åˆ†ç±»å·¥åŠ (Tag Studio)â€**ã€‚
è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿä¸­æœ€éœ€è¦â€œè§†è§‰åé¦ˆâ€çš„åœ°æ–¹ã€‚æŒ‰ç…§ä½ çš„è¦æ±‚ï¼Œæˆ‘ä»¬ä¸åšæ¯ç‡¥çš„è¡¨æ ¼ï¼Œè€Œæ˜¯åšä¸€ä¸ª**â€œæ‰€è§å³æ‰€å¾—â€çš„è°ƒè‰²ç›˜**ã€‚
ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡å·¥ä½œï¼ˆåˆ›å»ºæ–‡ä»¶å¤¹ï¼‰
æˆ‘ä»¬éœ€è¦åœ¨ cmd_generator ç›®å½•ä¸‹ç¡®ä¿æœ‰ views æ–‡ä»¶å¤¹ã€‚
 * å¦‚æœæœ‰ï¼Œç›´æ¥ç”¨ã€‚
 * å¦‚æœæ²¡æœ‰ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å« viewsã€‚
ç°åœ¨çš„ç»“æ„ï¼š
cmd_generator/
  â”œâ”€â”€ views/          <-- é©¬ä¸Šè¦åœ¨è¿™ä¸ªé‡Œé¢å†™ä»£ç 
  â”œâ”€â”€ ... (å…¶ä»–æ–‡ä»¶)

ç¬¬äºŒæ­¥ï¼šç¼–å†™â€œæ ‡ç­¾å·¥åŠâ€ç•Œé¢
æˆ‘ä»¬å°†å®ç°ä»¥ä¸‹é«˜çº§åŠŸèƒ½ï¼š
 * çµåŠ¨è°ƒè‰²ç›˜ï¼šé€‰é¢œè‰²æ—¶ï¼Œå³è¾¹å®æ—¶æ˜¾ç¤ºæ ‡ç­¾çš„æ ·å­ã€‚
 * åˆ†ç±»çœ‹æ¿ï¼šæŒ‰ç±»åˆ«ï¼ˆDatabase, OSç­‰ï¼‰è‡ªåŠ¨åˆ†ç»„å±•ç¤ºç°æœ‰çš„ Tagã€‚
 * å¿«é€Ÿç®¡ç†ï¼šæ–°å»ºå’Œåˆ é™¤éƒ½åœ¨ä¸€ä¸ªé¡µé¢å®Œæˆã€‚
æ–‡ä»¶è·¯å¾„ï¼šviews/tag_studio.py
æ“ä½œï¼šåœ¨ views æ–‡ä»¶å¤¹é‡Œæ–°å»º tag_studio.pyï¼Œå®Œæ•´å¤åˆ¶ä»¥ä¸‹ä»£ç ï¼š
# views/tag_studio.py
import streamlit as st
import streamlit_antd_components as sac
from core.tag_manager import TagManager
import time

def render_tag_studio():
    # 1. åˆå§‹åŒ–ç®¡ç†å™¨
    mgr = TagManager()
    all_tags = mgr.get_all_tags()
    categories = mgr.get_categories()

    # --- é¡¶éƒ¨ï¼šæ ‡é¢˜ ---
    st.markdown("## ğŸ·ï¸ æ ‡ç­¾ä¸åˆ†ç±»å·¥åŠ")
    st.caption("Tag Studio -åœ¨è¿™é‡Œå®šåˆ¶ä½ çš„è‰²å½©ç³»ç»Ÿ")

    # --- æ ¸å¿ƒåŒºåŸŸï¼šå·¦å³åˆ†æ  ---
    col_create, col_preview = st.columns([1.5, 2])

    # === å·¦ä¾§ï¼šåˆ›é€ åŒº (The Creator) ===
    with col_create:
        with st.container():
            st.markdown("### ğŸ¨ åˆ›å»ºæ–°æ ‡ç­¾")
            
            # 1. è¾“å…¥åå­—
            new_name = st.text_input("æ ‡ç­¾åç§°", placeholder="ä¾‹å¦‚: Nginx, Python...", key="tag_new_name")
            
            # 2. é€‰æ‹©æˆ–æ–°å»ºåˆ†ç±»
            # è¿™æ˜¯ä¸€ä¸ªé«˜çº§æŠ€å·§ï¼šå…è®¸é€‰æ‹©ç°æœ‰ï¼Œä¹Ÿå…è®¸ç›´æ¥è¾“å…¥æ–°çš„
            col_cat_sel, col_cat_new = st.columns([1, 1])
            with col_cat_sel:
                selected_cat = st.selectbox("é€‰æ‹©ç°æœ‰åˆ†ç±»", options=categories, key="tag_sel_cat")
            with col_cat_new:
                new_cat_input = st.text_input("æˆ–æ–°å»ºåˆ†ç±»", placeholder="New Category...", key="tag_new_cat_txt")
            
            final_cat = new_cat_input if new_cat_input else selected_cat

            # 3. é¢œè‰²é€‰æ‹©å™¨ (åŸç”Ÿç»„ä»¶ + å®æ—¶åé¦ˆ)
            # æˆ‘ä»¬é¢„è®¾ä¸€äº›é«˜çº§æ„Ÿé¢œè‰²ï¼Œæ–¹ä¾¿ç”¨æˆ·é€‰
            preset_colors = ["#FF6B6B", "#4D96FF", "#6BCB77", "#F7D716", "#9D4EDD", "#FF9F43", "#2C3A47"]
            
            st.write("é€‰æ‹©é…è‰²æ–¹æ¡ˆ")
            # è¿™é‡Œçš„ color_picker è¿”å›çš„æ˜¯ Hex ä»£ç 
            picked_color = st.color_picker("è‡ªå®šä¹‰é¢œè‰²", value="#4D96FF", key="tag_color_picker")

            # 4. ä¿å­˜æŒ‰é’®
            btn_save = st.button("âœ¨ ä¿å­˜æ ‡ç­¾", type="primary", use_container_width=True)

    # === å³ä¾§ï¼šå®æ—¶é¢„è§ˆåŒº (The Preview) ===
    with col_preview:
        # ä½¿ç”¨æˆ‘ä»¬åœ¨ CSS é‡Œå®šä¹‰çš„å¡ç‰‡æ ·å¼
        st.markdown('<div class="cmd-card" style="min-height: 320px;">', unsafe_allow_html=True)
        st.markdown("#### ğŸ‘ï¸ å®æ—¶é¢„è§ˆ (Live Preview)")
        
        if new_name:
            st.write("åœ¨å‘½ä»¤å¡ç‰‡ä¸­ï¼Œå®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š")
            # ä½¿ç”¨ sac.tags ç»„ä»¶æ¥æ¸²æŸ“ï¼Œè¿™æ¯” st.markdown ç¾è§‚å¾—å¤š
            sac.tags([
                sac.Tag(label=f"{final_cat}: {new_name}", color=picked_color, bordered=False),
            ], size='lg', align='center')
            
            st.markdown("---")
            st.caption(f"é…ç½®è¯¦æƒ…: Name=`{new_name}` | Cat=`{final_cat}` | Color=`{picked_color}`")
        else:
            st.info("ğŸ‘ˆ è¯·åœ¨å·¦ä¾§è¾“å…¥æ ‡ç­¾åç§°ä»¥æ¿€æ´»é¢„è§ˆ")
            # å±•ç¤ºä¸€ä¸ªç°è‰²çš„ç¤ºä¾‹
            sac.tags([sac.Tag(label="Example: Tag", color="#e0e0e0")], size='lg', align='center')
        
        st.markdown('</div>', unsafe_allow_html=True)

    # === é€»è¾‘å¤„ç†ï¼šä¿å­˜ ===
    if btn_save:
        if not new_name:
            st.toast("âš ï¸ åå­—ä¸èƒ½ä¸ºç©ºï¼", icon="âš ï¸")
        else:
            # 1. å¦‚æœæœ‰æ–°åˆ†ç±»ï¼Œå…ˆå­˜åˆ†ç±»
            if new_cat_input:
                mgr.add_category(new_cat_input)
            # 2. å­˜æ ‡ç­¾
            mgr.add_tag(new_name, final_cat, picked_color)
            st.toast(f"âœ… æ ‡ç­¾ [{new_name}] å·²åˆ›å»ºï¼", icon="ğŸ‰")
            time.sleep(1) # ç¨å¾®åœé¡¿ä¸€ä¸‹è®©ç”¨æˆ·çœ‹åˆ°æç¤º
            st.rerun()    # åˆ·æ–°é¡µé¢æ˜¾ç¤ºæ–°æ•°æ®

    st.markdown("---")

    # === åº•éƒ¨ï¼šç°æœ‰æ ‡ç­¾çœ‹æ¿ (Kanban View) ===
    st.markdown("### ğŸ“š ç°æœ‰æ ‡ç­¾åº“")
    
    if not all_tags:
        st.info("æš‚æ— æ ‡ç­¾ï¼Œå¿«å»ä¸Šé¢åˆ›å»ºä¸€ä¸ªå§ï¼")
    else:
        # è¿™ä¸€æ®µé€»è¾‘è´Ÿè´£æŠŠ Tag æŒ‰åˆ†ç±»åˆ†ç»„
        # æ•°æ®ç»“æ„è½¬æ¢: {"Database": [tag1, tag2], "OS": [tag3]}
        grouped_tags = {}
        for tid, tdata in all_tags.items():
            cat = tdata.get('category', 'Uncategorized')
            if cat not in grouped_tags: grouped_tags[cat] = []
            grouped_tags[cat].append({"id": tid, **tdata})

        # éå†æ˜¾ç¤º
        for cat, tags in grouped_tags.items():
            with st.container():
                st.caption(f"ğŸ“‚ {cat}")
                # å°† tags è½¬æ¢ä¸º sac ç»„ä»¶éœ€è¦çš„æ ¼å¼
                sac_items = [
                    sac.Tag(label=t['name'], color=t['color'], bordered=False) 
                    for t in tags
                ]
                sac.tags(sac_items, size='sm', align='start')
                st.markdown("") # åŠ ä¸€ç‚¹ç©ºè¡Œ

    # === åº•éƒ¨ï¼šåˆ é™¤åŠŸèƒ½ (Delete Zone) ===
    with st.expander("ğŸ—‘ï¸ ç®¡ç†ä¸åˆ é™¤æ¨¡å¼"):
        st.warning("æ³¨æ„ï¼šåˆ é™¤æ“ä½œä¸å¯æ¢å¤")
        # åˆ¶ä½œä¸€ä¸ªå­—å…¸ä¾›é€‰æ‹©ï¼š {ID: "åˆ†ç±»: åå­—"}
        delete_options = {tid: f"{t['category']}: {t['name']}" for tid, t in all_tags.items()}
        
        to_delete = st.multiselect(
            "é€‰æ‹©è¦åˆ é™¤çš„æ ‡ç­¾", 
            options=delete_options.keys(),
            format_func=lambda x: delete_options[x]
        )
        
        if st.button("ç¡®è®¤åˆ é™¤é€‰ä¸­é¡¹", type="secondary"):
            for tid in to_delete:
                mgr.delete_tag(tid)
            st.rerun()


ç¬¬ä¸‰æ­¥ï¼šè¿æ¥ä¸»ç¨‹åº
ç°åœ¨ä»£ç å†™å¥½äº†ï¼Œä½†ä¸»ç¨‹åº app.py è¿˜ä¸çŸ¥é“å®ƒçš„å­˜åœ¨ã€‚æˆ‘ä»¬éœ€è¦å»ä¿®æ”¹ app.pyï¼Œè®©èœå•ç‚¹å‡»â€œæ ‡ç­¾å·¥åŠâ€æ—¶ï¼ŒçœŸæ­£åŠ è½½è¿™ä¸ªæ–‡ä»¶ã€‚
æ–‡ä»¶è·¯å¾„ï¼šapp.py
æ“ä½œï¼šæ‰“å¼€ app.pyï¼Œæ‰¾åˆ° elif menu == 'æ ‡ç­¾å·¥åŠ': è¿™ä¸€æ®µï¼Œæ›¿æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š
# app.py ä¸­éœ€è¦ä¿®æ”¹çš„éƒ¨åˆ†

# ... (ä¸Šé¢çš„ä»£ç ä¿æŒä¸å˜) ...

elif menu == 'æ ‡ç­¾å·¥åŠ':
    # å¼•å…¥æˆ‘ä»¬åˆšæ‰å†™çš„æ¨¡å—
    from views.tag_studio import render_tag_studio
    render_tag_studio()

# ... (ä¸‹é¢çš„ä»£ç ä¿æŒä¸å˜) ...

ğŸš€ éªŒè¯æ—¶åˆ»
ç°åœ¨ï¼Œä¿å­˜æ‰€æœ‰æ–‡ä»¶ã€‚
å›åˆ°ç»ˆç«¯ï¼Œå¦‚æœ streamlit è¿˜åœ¨è¿è¡Œï¼Œå®ƒåº”è¯¥ä¼šè‡ªåŠ¨æ£€æµ‹åˆ°æ›´æ”¹å¹¶æç¤º Rerunï¼ˆæˆ–è€…ä½ ç›´æ¥æŒ‰ F5 åˆ·æ–°æµè§ˆå™¨ï¼‰ã€‚
å»ç‚¹å‡»å·¦ä¾§èœå•çš„ã€æ ‡ç­¾å·¥åŠã€‘ã€‚
è¯·å°è¯•æ“ä½œï¼š
 * å·¦ä¾§è¾“å…¥ï¼šåå­—å¡« Test, åˆ†ç±»é€‰ Database, é¢œè‰²é€‰ä¸€ä¸ªæ·±ç´«è‰²ã€‚
 * çœ‹å³ä¾§ï¼šä½ ä¼šå‘ç°å³è¾¹çš„å¡ç‰‡é‡Œï¼Œé‚£ä¸ª Tag ä¼šå®æ—¶å˜è‰²ã€‚
 * ç‚¹ä¿å­˜ï¼šå·¦ä¸‹è§’åº”è¯¥ä¼šå¼¹å‡ºâ€œğŸ‰ æ ‡ç­¾å·²åˆ›å»ºâ€ã€‚
 * çœ‹åº•éƒ¨ï¼šåœ¨â€œç°æœ‰æ ‡ç­¾åº“â€é‡Œï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„ Tag å·²ç»å½’ç±»å¥½äº†ã€‚
å¦‚æœè¿™æ­¥æˆåŠŸäº†ï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰äº†ä¸€ä¸ªé«˜é¢œå€¼çš„é…ç½®ä¸­å¿ƒã€‚
æ¥ä¸‹æ¥å°±æ˜¯æœ€å¤æ‚çš„**â€œç¼–è¾‘å™¨â€å’Œâ€œä¸»æ§åˆ¶å°â€**äº†ã€‚
è¿™æ­¥æå®šäº†å—ï¼Ÿæå®šè¯·å›å¤â€œOKâ€ï¼Œæˆ‘ä»¬ç»§ç»­æ”»å…‹â€œç¼–è¾‘å™¨â€ï¼
