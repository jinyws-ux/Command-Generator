æ”¶åˆ°ã€‚æ—¢ç„¶ä½ è®¤å¯è¿™ä¸ª â€œæ–°é‡å…½æ´¾ (Neo-Brutalism)â€ çš„é£æ ¼ï¼Œé‚£æˆ‘ä»¬å°±å½»åº•ä¸€ç‚¹ã€‚
è¿™æ¬¡é‡æ„ï¼Œæˆ‘ä¸å†åªæ˜¯æŠŠç»„ä»¶å †ä¸Šå»ï¼Œè€Œæ˜¯æŒ‰ç…§ â€œä¸“ä¸šå·¥ä½œå° (Pro Workspace)â€ çš„é€»è¾‘é‡æ–°è®¾è®¡å¸ƒå±€ã€‚
ğŸ“ æ ¸å¿ƒå¸ƒå±€è®¾è®¡ç†å¿µ
æˆ‘ä»¬è¦æŠ›å¼ƒ Streamlité‚£ç§â€œä»ä¸Šåˆ°ä¸‹â€çš„å•æµå¼å¸ƒå±€ï¼Œæ”¹ä¸º ä¸‰æ å¼å®½å±å¸ƒå±€ï¼š
 * å·¦ä¾§ï¼šæŒ‡ä»¤å¡” (Command Tower)
   * è´Ÿè´£å¯¼èˆªã€æ–°å»ºã€æ ‡ç­¾ç®¡ç†ã€‚
   * è®¾è®¡é£æ ¼ï¼šåƒä¸€ä¸ªå·¥å…·ç®±ï¼ŒæŒ‰é’®ç²—å¤§ï¼ŒåŠŸèƒ½é›†ä¸­ã€‚
 * ä¸­é—´ï¼šæ ¸å¿ƒçŸ©é˜µ (The Matrix)
   * å±•ç¤ºæ‰€æœ‰å‘½ä»¤å¡ç‰‡ã€‚
   * è®¾è®¡é£æ ¼ï¼šç€‘å¸ƒæµç½‘æ ¼ï¼Œå¡ç‰‡åƒå®ä½“ç£è´´ä¸€æ ·æµ®åœ¨èƒŒæ™¯ä¸Šã€‚
 * å³ä¾§ï¼šæ—¶å…‰æœº (Time Machine)
   * åƒæ‰“å°æœºçš„å‡ºçº¸å£ä¸€æ ·ï¼Œå®æ—¶åå‡ºä½ ç”Ÿæˆçš„å‘½ä»¤å†å²ã€‚
   * è®¾è®¡é£æ ¼ï¼šå¤å¤ç¥¨æ®æ ·å¼ã€‚
è¯·ç¡®ä¿ä½ å·²ç»å®‰è£…äº†æœ€æ–°ç‰ˆåº“ï¼ˆè§£å†³ä¹‹å‰çš„æŠ¥é”™ï¼‰ï¼š
pip install --upgrade nicegui pywebview
æ¥ä¸‹æ¥ï¼Œè¯·ç›´æ¥è¦†ç›–å¯¹åº”çš„ä¸‰ä¸ªæ–‡ä»¶ã€‚
1. ğŸ¨ çš®è‚¤å®šä¹‰ï¼štheme.py (æ›´æ¿€è¿›çš„æœ‹å…‹é£)
å¢åŠ äº†â€œå¤å¤æ‰“å°çº¸â€æ•ˆæœå’Œæ›´å¼ºçš„äº¤äº’åé¦ˆã€‚
# cmd_exe/theme.py
from nicegui import ui

# --- è°ƒè‰²ç›˜ (High Contrast) ---
BG_COLOR = "#E0E7FF"       # ææ·¡çš„è“ç´«è‰²åº•ï¼Œæ¯”çº¯ç™½æ›´æœ‰è´¨æ„Ÿ
PRIMARY = "#4F46E5"        # æ ¸å¿ƒè“
ACCENT_YELLOW = "#FEF08A"  # è§å…‰é»„ (ä¾¿ç­¾çº¸æ„Ÿ)
ACCENT_PINK = "#F472B6"    # æœ‹å…‹ç²‰
ACCENT_CYAN = "#22D3EE"    # èµ›åšé’
BLACK = "#111827"          # å¢¨é»‘

# --- ç»„ä»¶æ ·å¼ (Tailwind Class Strings) ---

# 1. é‡å…½æ´¾å®¹å™¨ (ç™½åº• + ç²—é»‘æ¡† + ç¡¬æŠ•å½±)
BRUTAL_BOX = (
    "background-color: white; "
    "border: 3px solid black; "
    "box-shadow: 6px 6px 0px 0px black; "
    "border-radius: 0px; " # ç›´è§’ï¼Œæ›´ç¡¬æœ—
)

# 2. äº¤äº’æŒ‰é’® (æ‚¬åœå˜è‰² + ç‚¹å‡»ä¸‹é™·)
# active:translate æ¨¡æ‹ŸæŒ‰é”®ç‰©ç†åé¦ˆ
BRUTAL_BTN = (
    "border: 2px solid black; "
    "font-weight: 800; "
    "text-transform: uppercase; "
    "letter-spacing: 1px; "
    "box-shadow: 3px 3px 0px 0px black; "
    "transition: all 0.1s; "
    "border-radius: 6px; "
)
# æŒ‰é’®æŒ‰ä¸‹æ—¶çš„ CSS ç±» (åœ¨ä»£ç ä¸­åŠ¨æ€æ·»åŠ /åˆ©ç”¨ active ä¼ªç±»)
BTN_ACTIVE = "active:translate-y-1 active:shadow-none"

# 3. å¤å¤è¾“å…¥æ¡†
BRUTAL_INPUT = (
    "border: 2px solid black; "
    "background-color: #F9FAFB; "
    "padding: 8px; "
    "font-family: 'JetBrains Mono', monospace; "
    "border-radius: 4px; "
    "box-shadow: 2px 2px 0px 0px rgba(0,0,0,0.2); "
)

def setup_theme():
    """æ³¨å…¥å…¨å±€å­—ä½“å’ŒèƒŒæ™¯çº¹ç†"""
    ui.add_head_html('''
        <style>
            @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Chakra+Petch:wght@400;700&display=swap');
            
            body {
                background-color: #E0E7FF;
                /* æ–¹æ ¼çº¸çº¹ç† */
                background-image: 
                    linear-gradient(#cbd5e1 1px, transparent 1px),
                    linear-gradient(90deg, #cbd5e1 1px, transparent 1px);
                background-size: 40px 40px;
                font-family: 'Chakra Petch', sans-serif; /* æ›´æœ‰ç§‘æŠ€æ„Ÿçš„å­—ä½“ */
                color: #111827;
            }
            
            /* æ»šåŠ¨æ¡ç¾åŒ– */
            ::-webkit-scrollbar { width: 10px; }
            ::-webkit-scrollbar-track { background: #E0E7FF; border-left: 2px solid black; }
            ::-webkit-scrollbar-thumb { background: black; border: 2px solid #E0E7FF; }
            ::-webkit-scrollbar-thumb:hover { background: #4F46E5; }
        </style>
    ''')

2. ğŸ§  æ ¸å¿ƒé€»è¾‘ï¼šlogic.py (ä¿æŒç¨³å®š)
è¿™ä¸ªæ–‡ä»¶ä¸éœ€è¦å¤§æ”¹ï¼Œåªè¦ä¿è¯æ•°æ®è¯»å†™æ­£å¸¸ã€‚
# cmd_exe/logic.py
import json
import os
import uuid
import shlex
from jinja2 import Template

DATA_DIR = "data"
if not os.path.exists(DATA_DIR): os.makedirs(DATA_DIR)

class DataManager:
    def __init__(self):
        self.tag_file = os.path.join(DATA_DIR, "tags.json")
        self.tmpl_file = os.path.join(DATA_DIR, "templates.json")
        self._init_files()

    def _init_files(self):
        if not os.path.exists(self.tag_file):
            default_tags = {
                "t1": {"name": "PROD", "color": "#F472B6", "cat": "Env"},
                "t2": {"name": "DB", "color": "#22D3EE", "cat": "Type"}
            }
            with open(self.tag_file, 'w') as f: json.dump(default_tags, f)
        if not os.path.exists(self.tmpl_file):
            with open(self.tmpl_file, 'w') as f: json.dump({}, f)

    def get_tags(self):
        try:
            with open(self.tag_file, 'r') as f: return json.load(f)
        except: return {}

    def get_templates(self):
        try:
            with open(self.tmpl_file, 'r') as f: return json.load(f)
        except: return {}

    def save_template(self, tid, data):
        all_data = self.get_templates()
        all_data[tid] = data
        with open(self.tmpl_file, 'w') as f: json.dump(all_data, f, indent=2)

    def delete_template(self, tid):
        all_data = self.get_templates()
        if tid in all_data:
            del all_data[tid]
            with open(self.tmpl_file, 'w') as f: json.dump(all_data, f, indent=2)

    def render(self, tmpl_str, params):
        safe = {k: (shlex.quote(str(v)) if isinstance(v, str) else v) for k,v in params.items()}
        return Template(tmpl_str).render(**safe)

db = DataManager()

3. ğŸ¦´ éª¨æ¶ä¸å¸ƒå±€ï¼šmain.py (é‡æ„é‡ç‚¹)
è¿™æ˜¯æœ¬æ¬¡ä¿®æ”¹çš„æ ¸å¿ƒã€‚æˆ‘ä½¿ç”¨äº† NiceGUI çš„ ui.row å’Œ ui.column æ„å»ºäº†ä¸¥è°¨çš„ä¸‰æ å¸ƒå±€ã€‚
æ“ä½œï¼šè¦†ç›– cmd_exe/main.pyã€‚
# cmd_exe/main.py
from nicegui import ui
from logic import db
import theme
import uuid
import datetime

theme.setup_theme()

# =======================================================
# è‡ªå®šä¹‰ç»„ä»¶ (Brutal UI Components)
# =======================================================

def b_button(text, icon=None, bg_color="white", text_color="black", on_click=None):
    """é‡å…½æ´¾æŒ‰é’®"""
    return ui.button(text, icon=icon, on_click=on_click) \
        .style(theme.BRUTAL_BTN + f"background-color: {bg_color}; color: {text_color};") \
        .classes(theme.BTN_ACTIVE)

def b_tag(text, bg_color="#E5E7EB"):
    """é‡å…½æ´¾æ ‡ç­¾"""
    ui.label(text).style(f"background: {bg_color}; border: 2px solid black; box-shadow: 2px 2px 0 black;") \
        .classes('px-2 py-0.5 text-xs font-bold mr-1 mb-1')

# =======================================================
# é¡µé¢å¸ƒå±€ (Layout Architecture)
# =======================================================

# 1. é¡¶æ  (Header)
with ui.header().classes('bg-transparent pointer-events-none'): # é€åº•
    with ui.row().classes('w-full pointer-events-auto justify-between items-center px-6 py-4'):
        # Logo åŒºåŸŸ
        with ui.row().classes('gap-0 items-end'):
            ui.label('CMD').style('background: black; color: white; padding: 4px 12px; font-weight: 900; font-size: 28px; border: 3px solid black;')
            ui.label('GEN').style('background: white; color: black; padding: 4px 12px; font-weight: 900; font-size: 28px; border: 3px solid black; border-left: none;')
        
        # æœç´¢æ¡
        search_input = ui.input(placeholder='SEARCH_MODULES...') \
            .props('outlined dense').style(theme.BRUTAL_INPUT + "background: white; width: 300px;")

# 2. ä¸»ä½“å®¹å™¨ (ä½¿ç”¨ Grid åˆ†å‰²å·¦å³åŒºåŸŸ)
# å·¦ä¾§å›ºå®šå®½ 260pxï¼Œå³ä¾§å›ºå®šå®½ 300pxï¼Œä¸­é—´è‡ªé€‚åº”
with ui.row().classes('w-full h-[calc(100vh-100px)] gap-6 px-6 no-wrap items-start'):
    
    # === å·¦ä¾§ï¼šæŒ‡ä»¤å¡” (Command Tower) ===
    with ui.column().style(theme.BRUTAL_BOX).classes('w-[260px] h-full p-4 gap-4 flex-shrink-0 bg-white'):
        ui.label('CONTROL_PANEL').classes('font-bold text-gray-400 text-xs tracking-widest')
        
        # å¤§æŒ‰é’®ç»„
        b_button('NEW COMMAND', 'add', bg_color=theme.ACCENT_CYAN, on_click=lambda: open_editor()).classes('w-full h-12 text-lg')
        b_button('TAG MANAGER', 'label', bg_color='white', on_click=lambda: ui.notify('Tag Manager coming soon!')).classes('w-full')
        
        ui.separator().classes('bg-black h-[2px]')
        
        # ç»Ÿè®¡ä¿¡æ¯
        with ui.column().classes('gap-1'):
            ui.label('SYSTEM STATUS').classes('font-bold text-xs')
            with ui.row().classes('justify-between w-full'):
                ui.label('Modules:').classes('font-mono text-sm')
                count_label = ui.label('0').classes('font-mono font-bold bg-black text-white px-2')

    # === ä¸­é—´ï¼šæ ¸å¿ƒçŸ©é˜µ (The Matrix) ===
    # ä½¿ç”¨ ScrollArea è®©ä¸­é—´å¯ä»¥æ»šåŠ¨
    with ui.scroll_area().classes('flex-grow h-full pr-4'):
        
        # åˆ·æ–°å®¹å™¨
        grid_container = ui.row().classes('w-full gap-4 items-start content-start')

        def refresh_grid(filter_text=""):
            grid_container.clear()
            templates = db.get_templates()
            tags_map = db.get_tags()
            
            # æ›´æ–°å·¦ä¾§ç»Ÿè®¡
            count_label.text = str(len(templates))
            
            with grid_container:
                if not templates:
                    with ui.column().classes('w-full items-center py-20 opacity-40'):
                        ui.icon('apps', size='64px')
                        ui.label('NO MODULES LOADED').classes('font-bold text-xl mt-4')
                    return

                for tid, t in templates.items():
                    if filter_text and filter_text.lower() not in t['name'].lower(): continue

                    # --- å¡ç‰‡è®¾è®¡ ---
                    with ui.card().style(theme.BRUTAL_BOX).classes('w-[280px] p-0 flex flex-col justify-between group cursor-default hover:-translate-y-1 transition-transform'):
                        
                        # 1. æ ‡é¢˜æ  (å½©è‰²)
                        with ui.row().style(f'background:{theme.ACCENT_YELLOW}; border-bottom: 3px solid black;').classes('w-full p-3 justify-between items-center'):
                            ui.label(t['name']).classes('font-black text-lg truncate')
                            ui.button(icon='edit', on_click=lambda id=tid: open_editor(id)).props('flat dense round color=black size=sm')

                        # 2. å†…å®¹åŒº
                        with ui.column().classes('p-3 gap-2 flex-grow'):
                            # æè¿°
                            ui.label(t.get('desc', 'No description.')).classes('text-xs font-mono text-gray-500 line-clamp-2 h-8')
                            
                            # æ ‡ç­¾å±•ç¤º
                            with ui.row().classes('gap-0'):
                                for tag_id in t.get('tags', []):
                                    if tag_id in tags_map:
                                        b_tag(tags_map[tag_id]['name'], tags_map[tag_id].get('color', '#eee'))
                        
                        # 3. åº•éƒ¨æ‰§è¡ŒæŒ‰é’®
                        b_button('RUN', 'play_arrow', bg_color='black', text_color='white', on_click=lambda id=tid: open_runner(id)) \
                            .classes('m-3 shadow-none border-white border-2') # ç‰¹æ®Šæ ·å¼

        refresh_grid()
        search_input.on('change', lambda e: refresh_grid(e.value))

    # === å³ä¾§ï¼šæ—¶å…‰æœº (Time Machine) ===
    with ui.column().style(theme.BRUTAL_BOX).classes('w-[300px] h-full p-0 flex-shrink-0 bg-gray-50 overflow-hidden'):
        # æ ‡é¢˜å¤´
        ui.label('OUTPUT_LOG').style('background: black; color: white; padding: 8px; font-weight: bold; text-align: center; width: 100%;')
        
        # æ»šåŠ¨æ—¥å¿—åŒº
        log_area = ui.scroll_area().classes('w-full flex-grow p-4 gap-3 bg-[url("https://www.transparenttextures.com/patterns/graphy.png")]')
        
        def add_log(cmd_str):
            with log_area:
                # ç¥¨æ®æ ·å¼çš„æ—¥å¿—æ¡
                with ui.column().style('background: white; border: 2px dashed black; padding: 8px; box-shadow: 2px 2px 0 rgba(0,0,0,0.2);').classes('w-full mb-3'):
                    ui.label(datetime.datetime.now().strftime("%H:%M:%S")).classes('text-[10px] font-bold text-gray-400')
                    ui.code(cmd_str).classes('text-xs font-mono break-all bg-transparent p-0 text-red-600')
                    with ui.row().classes('w-full justify-end'):
                        ui.button(icon='content_copy', on_click=lambda: ui.clipboard.write(cmd_str)).props('flat dense round size=xs color=black')
            log_area.scroll_to(percent=1.0) # è‡ªåŠ¨æ»šåˆ°åº•éƒ¨

# =======================================================
# å¼¹çª—é€»è¾‘ (Dialogs)
# =======================================================

def open_runner(tid):
    data = db.get_templates().get(tid)
    if not data: return
    
    with ui.dialog() as dialog, ui.card().style(theme.BRUTAL_BOX).classes('min-w-[500px] p-0'):
        # å¼¹çª—å¤´
        with ui.row().style(f'background:{theme.ACCENT_PINK}; border-bottom: 3px solid black;').classes('w-full p-4 justify-between items-center'):
            ui.label(f">> EXECUTE_MODE").classes('font-black text-xl')
            ui.button(icon='close', on_click=dialog.close).props('flat dense round color=black')
        
        # è¡¨å•åŒº
        inputs = {}
        with ui.column().classes('p-6 gap-4 w-full bg-white'):
            for p in data.get('params', []):
                ui.label(p.get('label', p['name'])).classes('font-bold text-xs mb-[-8px]')
                inputs[p['name']] = ui.input(value=p.get('default', '')).props('dense outlined').style(theme.BRUTAL_INPUT).classes('w-full')
            
            # ç»“æœé¢„è§ˆæ¡†
            ui.label('PREVIEW').classes('font-bold text-xs mt-2')
            res_box = ui.code('Wait...').classes('w-full p-3 border-2 border-black bg-black text-green-400 font-mono rounded-none')
            
            def run_gen():
                try:
                    params = {k: v.value for k,v in inputs.items()}
                    res = db.render(data.get('template', ''), params)
                    res_box.content = res
                    # æ·»åŠ åˆ°å³ä¾§æ—¥å¿—
                    add_log(res)
                    ui.clipboard.write(res)
                    ui.notify('COPIED TO CLIPBOARD', color='black')
                except Exception as e:
                    ui.notify(str(e), color='red')

            b_button('GENERATE', 'bolt', bg_color=theme.ACCENT_CYAN, on_click=run_gen).classes('w-full mt-2')

    dialog.open()

def open_editor(tid=None):
    is_edit = tid is not None
    data = db.get_templates().get(tid, {}) if is_edit else {}
    
    with ui.dialog() as dialog, ui.card().style(theme.BRUTAL_BOX).classes('min-w-[800px] h-[600px] p-0'):
        # å¼¹çª—å¤´
        with ui.row().style('background:black; color:white;').classes('w-full p-3 justify-between items-center'):
            ui.label('BLUEPRINT_EDITOR').classes('font-mono font-bold text-lg')
            ui.button(icon='close', on_click=dialog.close).props('flat dense round color=white')
        
        # åˆ†æ å¸ƒå±€ (å·¦è¾¹é…ç½®ï¼Œå³è¾¹ä»£ç )
        with ui.row().classes('w-full h-full no-wrap'):
            
            # å·¦ä¾§ï¼šè¡¨å•é…ç½®
            with ui.column().classes('w-1/2 h-full p-6 gap-4 border-r-2 border-black bg-gray-50'):
                ui.label('METADATA').classes('font-black text-sm')
                name = ui.input('NAME', value=data.get('name','')).props('dense outlined').style(theme.BRUTAL_INPUT).classes('w-full bg-white')
                desc = ui.input('DESC', value=data.get('desc','')).props('dense outlined').style(theme.BRUTAL_INPUT).classes('w-full bg-white')
                
                ui.separator().classes('bg-black')
                
                ui.label('PARAMETERS (CSV Format)').classes('font-black text-sm')
                ui.label('Format: var_name, Label, default_value').classes('text-[10px] text-gray-500')
                
                # ç®€å•å‚æ•°è§£æå™¨
                def params_to_str(plist): return "\n".join([f"{p['name']},{p.get('label','')},{p.get('default','')}" for p in plist])
                def str_to_params(txt): 
                    return [{"name": l.split(',')[0].strip(), "label": l.split(',')[1].strip() if ',' in l else l.split(',')[0], "default": l.split(',')[2].strip() if l.count(',')>=2 else ""} for l in txt.split('\n') if l.strip()]
                
                p_input = ui.textarea(value=params_to_str(data.get('params',[]))).props('dense outlined').style(theme.BRUTAL_INPUT).classes('w-full flex-grow bg-white font-mono text-xs')

            # å³ä¾§ï¼šæ¨¡æ¿ä»£ç 
            with ui.column().classes('w-1/2 h-full p-6 gap-4 bg-white'):
                ui.label('TEMPLATE (JINJA2)').classes('font-black text-sm')
                t_input = ui.textarea(value=data.get('template','')).props('dense outlined borderless').style("border:none; background:#111; color:#0f0; font-family:monospace; padding:10px; height:100%; width:100%; resize:none;")
                
                # åº•éƒ¨æŒ‰é’®æ 
                with ui.row().classes('w-full justify-end pt-4 border-t-2 border-black'):
                    if is_edit:
                        ui.button('DELETE', on_click=lambda: [db.delete_template(tid), refresh_grid(), dialog.close()]).props('flat color=red')
                    
                    def save():
                        if not name.value: return ui.notify('Name required', color='red')
                        save_id = tid if is_edit else str(uuid.uuid4())[:8]
                        new_data = {
                            "name": name.value, "desc": desc.value, 
                            "template": t_input.value, 
                            "params": str_to_params(p_input.value),
                            "tags": data.get('tags', [])
                        }
                        db.save_template(save_id, new_data)
                        refresh_grid()
                        dialog.close()
                        ui.notify('SAVED', color='black')

                    b_button('SAVE MODULE', 'save', bg_color=theme.ACCENT_YELLOW, on_click=save)

    dialog.open()

# å¯åŠ¨
ui.run(title="CMD_NEXUS_PRO", native=True, window_size=(1200, 800), reload=False)

ğŸš€ è§†è§‰å‡çº§ç‚¹è¯´æ˜
 * ä¸‰æ å¸ƒå±€ï¼šå·¦è¾¹æ˜¯åŠŸèƒ½åŒºï¼Œä¸­é—´æ˜¯å±•ç¤ºåŒºï¼Œå³è¾¹æ˜¯æ—¥å¿—åŒºï¼Œåƒæäº†ä¸“ä¸šçš„ IDE æˆ–è€…æ§åˆ¶å°ï¼Œä¸å†æ˜¯å•è°ƒçš„ç½‘é¡µã€‚
 * é‡å…½æ´¾ç»†èŠ‚ï¼š
   * ç¡¬é˜´å½±ï¼šæ‰€æœ‰çš„å¡ç‰‡ã€æŒ‰é’®éƒ½æœ‰ box-shadow: Xpx Xpx 0 blackï¼Œæ²¡æœ‰é‚£ç§è½¯ç»µç»µçš„æ¨¡ç³Šé˜´å½±ã€‚
   * ç²—è¾¹æ¡†ï¼šborder: 3px solid blackï¼ŒåŠ›é‡æ„Ÿåè¶³ã€‚
   * é«˜å¯¹æ¯”åº¦ï¼šä½¿ç”¨äº†è§å…‰é»„ã€èµ›åšé’ã€æœ‹å…‹ç²‰ä½œä¸ºç‚¹ç¼€è‰²ã€‚
 * å³ä¾§æ—¥å¿—åŒºï¼šæ¯æ¬¡è¿è¡Œå®Œå‘½ä»¤ï¼Œå³è¾¹ä¼šè‡ªåŠ¨åƒæ‰“å°å°ç¥¨ä¸€æ ·åå‡ºä¸€æ¡è®°å½•ï¼Œçœ‹ç€éå¸¸çˆ½ã€‚
è¯·è¿è¡Œ python main.pyï¼Œçœ‹çœ‹è¿™ä¸ªå…¨æ–°çš„æ’ç‰ˆæ˜¯å¦ç¬¦åˆä½ çš„å¿ƒæ„ï¼
