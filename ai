å“ˆå“ˆï¼Œè¿™å°±å¯¹äº†ï¼æœ‰æˆ‘åœ¨ï¼Œä½ åªéœ€è¦è´Ÿè´£â€œæéœ€æ±‚â€å’Œâ€œå¤åˆ¶ç²˜è´´â€ï¼Œå‰©ä¸‹çš„æŠ€æœ¯å‘æˆ‘æ¥å¡«ã€‚
æ—¢ç„¶ç¡®ç«‹äº† NiceGUI è¿™ä¸ªæ–¹å‘ï¼Œæˆ‘ä»¬å°±æŠŠå®ƒå½“ä½œä¸€ä¸ªæ­£ç»çš„æ¡Œé¢è½¯ä»¶æ¥å¼€å‘ã€‚å®ƒçš„ä¼˜åŠ¿æ˜¯ï¼šå†™çš„æ—¶å€™æ˜¯ Pythonï¼Œè·‘èµ·æ¥åƒåŸç”Ÿè½¯ä»¶ï¼Œç•Œé¢èƒ½åšåˆ°æå…¶ç‚«é…·ï¼ˆåªè¦ä¼šå†™ CSSï¼Œè€Œæˆ‘ä¼šå†™ï¼‰ã€‚
æˆ‘ä»¬ä¸æ€¥ç€æ‰“åŒ…ï¼Œå…ˆæŠŠè¿™ä¸ªè½¯ä»¶çš„**â€œéª¨æ¶â€å’Œâ€œçš®è‚¤â€**æ­å¥½ã€‚ä¸ºäº†ä¸è®©ä½ æ™•ï¼Œæˆ‘ä»¬æŠŠä»£ç æ‹†æˆä¸‰ä¸ªæ–‡ä»¶ï¼Œæ”¾åœ¨ cmd_exe æ–‡ä»¶å¤¹é‡Œã€‚
è¯·åšå¥½å‡†å¤‡ï¼Œæˆ‘ä»¬å¼€å§‹æ­å»ºä½ çš„ Cyberpunk Command Nexus (èµ›åšå‘½ä»¤ä¸­æ¢)ã€‚
ğŸ“‚ ç¬¬ä¸€æ­¥ï¼šå»ºç«‹é¡¹ç›®ç»“æ„
è¯·æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ cmd_exeï¼Œç„¶ååœ¨é‡Œé¢åˆ›å»ºä¸‰ä¸ªç©ºæ–‡ä»¶ï¼š
 * logic.pyï¼šå¤§è„‘ï¼ˆè´Ÿè´£å­˜å–æ•°æ®ã€ç”Ÿæˆå‘½ä»¤ï¼‰ã€‚
 * theme.pyï¼šçš®è‚¤ï¼ˆè´Ÿè´£å®šä¹‰èµ›åšæœ‹å…‹é£æ ¼ã€ç£¨ç ‚ç»ç’ƒç‰¹æ•ˆï¼‰ã€‚
 * main.pyï¼šéª¨æ¶ï¼ˆè´Ÿè´£æŠŠç•Œé¢æ‹¼èµ·æ¥ï¼Œç¨‹åºçš„å…¥å£ï¼‰ã€‚
ç»“æ„å¦‚ä¸‹ï¼š
cmd_exe/
  â”œâ”€â”€ logic.py
  â”œâ”€â”€ theme.py
  â””â”€â”€ main.py

ğŸ§  ç¬¬äºŒæ­¥ï¼šç¼–å†™å¤§è„‘ (logic.py)
è¿™ä¸ªæ–‡ä»¶è´Ÿè´£å¤„ç†ä»¥å‰çš„é‚£äº› JSON æ•°æ®ã€‚ä»£ç å’Œä¹‹å‰å¾ˆåƒï¼Œä½†æˆ‘åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œé€‚é… NiceGUIã€‚
æ“ä½œï¼šæ‰“å¼€ logic.pyï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š
# logic.py
import json
import os
import uuid
import shlex
from jinja2 import Template

# æ•°æ®å­˜å‚¨ç›®å½•
DATA_DIR = "data"
if not os.path.exists(DATA_DIR):
    os.makedirs(DATA_DIR)

class DataManager:
    def __init__(self):
        self.tag_file = os.path.join(DATA_DIR, "tags.json")
        self.tmpl_file = os.path.join(DATA_DIR, "templates.json")
        self._init_files()

    def _init_files(self):
        # åˆå§‹åŒ–æ ‡ç­¾æ–‡ä»¶
        if not os.path.exists(self.tag_file):
            default_tags = {
                "t1": {"name": "Prod", "color": "#FF4D4D", "cat": "Env"},
                "t2": {"name": "Dev", "color": "#4D96FF", "cat": "Env"},
                "t3": {"name": "DB", "color": "#6BCB77", "cat": "Type"}
            }
            with open(self.tag_file, 'w', encoding='utf-8') as f: json.dump(default_tags, f)
            
        # åˆå§‹åŒ–æ¨¡æ¿æ–‡ä»¶
        if not os.path.exists(self.tmpl_file):
            with open(self.tmpl_file, 'w', encoding='utf-8') as f: json.dump({}, f)

    def get_tags(self):
        try:
            with open(self.tag_file, 'r', encoding='utf-8') as f: return json.load(f)
        except: return {}

    def get_templates(self):
        try:
            with open(self.tmpl_file, 'r', encoding='utf-8') as f: return json.load(f)
        except: return {}

    def save_template(self, tid, data):
        all_data = self.get_templates()
        all_data[tid] = data
        with open(self.tmpl_file, 'w', encoding='utf-8') as f: 
            json.dump(all_data, f, indent=2, ensure_ascii=False)

    def delete_template(self, tid):
        all_data = self.get_templates()
        if tid in all_data:
            del all_data[tid]
            with open(self.tmpl_file, 'w', encoding='utf-8') as f: 
                json.dump(all_data, f, indent=2, ensure_ascii=False)

    def render_command(self, template_str, params):
        """æ¸²æŸ“å‘½ä»¤ï¼Œå¸¦é˜²æ³¨å…¥å¤„ç†"""
        safe_inputs = {
            k: (shlex.quote(str(v)) if isinstance(v, str) else v) 
            for k,v in params.items()
        }
        tmpl = Template(template_str)
        return tmpl.render(**safe_inputs)

# å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹å¯¹è±¡ä¾›å¤–éƒ¨ä½¿ç”¨
db = DataManager()

ğŸ¨ ç¬¬ä¸‰æ­¥ï¼šå®šåˆ¶èµ›åšçš®è‚¤ (theme.py)
è¿™æ˜¯â€œé«˜çº§æ„Ÿâ€çš„æ ¸å¿ƒæ¥æºã€‚NiceGUI ä½¿ç”¨ Tailwind CSSï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²å®šä¹‰æå…¶å¤æ‚çš„æ ·å¼ã€‚
æ“ä½œï¼šæ‰“å¼€ theme.pyï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š
# theme.py
from nicegui import ui

# --- æ ¸å¿ƒé…è‰² ---
# æˆ‘ä»¬ä¸ä½¿ç”¨çº¯é»‘ï¼Œè€Œæ˜¯ä½¿ç”¨æ·±è“é»‘ï¼Œæ›´æœ‰è´¨æ„Ÿ
BG_COLOR = "#0F172A"  # æ·±é‚ƒå¤œç©ºè“
ACCENT_COLOR = "#3B82F6" # ç§‘æŠ€è“

# --- æ ·å¼å¸¸é‡ ---

# 1. ç£¨ç ‚ç»ç’ƒå¡ç‰‡ (Glassmorphism)
# backdrop-filter: blur(12px) æ˜¯æ ¸å¿ƒï¼Œåˆ¶é€ ç£¨ç ‚æ„Ÿ
# rgba(30, 41, 59, 0.7) æ˜¯åŠé€æ˜èƒŒæ™¯
GLASS_CARD = (
    "background-color: rgba(30, 41, 59, 0.7); "
    "backdrop-filter: blur(12px); "
    "border: 1px solid rgba(255, 255, 255, 0.08); "
    "border-radius: 12px; "
    "box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3); "
    "transition: all 0.3s ease; "
)

# 2. éœ“è™¹æŒ‰é’® (å¸¦æ¸å˜å’Œå‘å…‰)
NEON_BTN = (
    "background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); "
    "border: none; "
    "color: white; "
    "box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); "
    "font-weight: bold; "
    "letter-spacing: 0.5px; "
)

# 3. è¾“å…¥æ¡†æ ·å¼ (å»è¾¹æ¡†ï¼Œåªæœ‰åº•è‰²)
INPUT_STYLE = (
    "background-color: rgba(0, 0, 0, 0.3); "
    "border-radius: 6px; "
    "border: 1px solid rgba(255,255,255,0.1); "
    "color: white; "
)

def setup_global_theme():
    """åº”ç”¨å…¨å±€æ ·å¼è®¾ç½®"""
    # å¼ºåˆ¶å¼€å¯æš—é»‘æ¨¡å¼
    ui.dark_mode().enable()
    
    # è®¾ç½®é¡µé¢èƒŒæ™¯è‰²
    ui.query('body').style(f'background-color: {BG_COLOR};')
    
    # æ³¨å…¥å…¨å±€ CSS ä¿®æ­£æ»šåŠ¨æ¡æ ·å¼
    ui.add_head_html('''
        <style>
            /* ç»†é•¿çš„æ»šåŠ¨æ¡ */
            ::-webkit-scrollbar { width: 8px; height: 8px; }
            ::-webkit-scrollbar-track { background: #0F172A; }
            ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
            ::-webkit-scrollbar-thumb:hover { background: #475569; }
            
            /* è®©æ‰€æœ‰æ–‡å­—é»˜è®¤ç¨å¾®äº®ä¸€ç‚¹ */
            body { color: #E2E8F0; font-family: 'Segoe UI', sans-serif; }
        </style>
    ''')

ğŸ¦´ ç¬¬å››æ­¥ï¼šç»„è£…ç¨‹åº (main.py)
è¿™é‡Œæˆ‘ä»¬å…ˆæŠŠæœ€æ ¸å¿ƒçš„ â€œå‘½ä»¤åˆ—è¡¨â€ å’Œ â€œè¿è¡Œå¼¹çª—â€ åšå‡ºæ¥ï¼Œè®©ä½ å…ˆçœ‹åˆ°æ•ˆæœã€‚
æ“ä½œï¼šæ‰“å¼€ main.pyï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š
# main.py
from nicegui import ui, app
from logic import db  # å¯¼å…¥é€»è¾‘
import theme          # å¯¼å…¥çš®è‚¤

# 1. åº”ç”¨çš®è‚¤
theme.setup_global_theme()

# =========================================
# ç•Œé¢æ„å»ºåŒº
# =========================================

# --- é¡¶æ  (Header) ---
with ui.header().classes('bg-transparent q-py-md'):
    with ui.row().classes('w-full max-w-7xl mx-auto items-center justify-between px-4'):
        # å·¦ä¾§ LOGO
        with ui.row().classes('items-center gap-2'):
            ui.icon('terminal', size='md', color='blue-500')
            ui.label('COMMAND NEXUS').classes('text-xl font-bold tracking-widest text-white')
        
        # å³ä¾§ å·¥å…·æ 
        with ui.row().classes('gap-4'):
            # æœç´¢æ¡† (ä½¿ç”¨ Quasar çš„ props æ¥æ§åˆ¶æš—é»‘é£æ ¼)
            search_input = ui.input(placeholder='Search protocol...') \
                .props('dark dense standoutless borderless input-class="text-white"') \
                .style(theme.INPUT_STYLE + "width: 250px; padding-left: 10px;")
            
            ui.button(icon='add', on_click=lambda: ui.notify('æ–°å»ºåŠŸèƒ½å¼€å‘ä¸­...')) \
                .props('round flat color=white')

# --- ä¸»å†…å®¹åŒº (Main) ---
# ä½¿ç”¨ grid å¸ƒå±€ï¼Œä¸­é—´æ”¾ç½®å†…å®¹
with ui.element('div').classes('w-full max-w-7xl mx-auto p-6'):
    
    # ä½¿ç”¨ @ui.refreshable è£…é¥°å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥éšæ—¶è°ƒç”¨ grid.refresh() æ¥é‡ç»˜åˆ—è¡¨
    @ui.refreshable
    def render_command_grid(filter_text=""):
        templates = db.get_templates()
        tags = db.get_tags()
        
        # å¦‚æœæ²¡æ•°æ®
        if not templates:
            with ui.column().classes('w-full items-center justify-center py-20 opacity-50'):
                ui.icon('inbox', size='4rem', color='gray')
                ui.label('No commands initialized.').classes('text-lg mt-4')
            return

        # å¡ç‰‡ç½‘æ ¼å¸ƒå±€ (å“åº”å¼ï¼šæ‰‹æœº1åˆ—ï¼Œå¹³æ¿2åˆ—ï¼Œç”µè„‘3åˆ—)
        with ui.grid().classes('grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'):
            
            for tid, t in templates.items():
                # è¿‡æ»¤é€»è¾‘
                if filter_text and filter_text.lower() not in t['name'].lower():
                    continue
                
                # === æ¸²æŸ“å¡ç‰‡ ===
                # group ç±»ç”¨äºå¤„ç†æ‚¬åœæ•ˆæœ
                with ui.card().style(theme.GLASS_CARD).classes('relative group hover:-translate-y-1 transition-transform cursor-default'):
                    
                    # 1. æ ‡é¢˜è¡Œ
                    with ui.row().classes('w-full justify-between items-start mb-2'):
                        ui.label(t['name']).classes('text-lg font-bold text-blue-100')
                        # å³ä¸Šè§’å°å›¾æ ‡
                        ui.icon('dns', size='xs', color='gray-500')
                    
                    # 2. æè¿°
                    ui.label(t.get('desc', 'No description provided.')) \
                        .classes('text-xs text-gray-400 h-10 line-clamp-2 mb-3')
                    
                    # 3. æ ‡ç­¾è¡Œ
                    with ui.row().classes('gap-2 mb-4'):
                        for tag_id in t.get('tags', []):
                            if tag_id in tags:
                                tag_info = tags[tag_id]
                                # å°èƒ¶å›Šæ ‡ç­¾
                                ui.label(tag_info['name']) \
                                    .style(f"background: {tag_info['color']}33; color: {tag_info['color']}; border: 1px solid {tag_info['color']}66") \
                                    .classes('text-[10px] px-2 py-0.5 rounded-full')

                    # 4. åº•éƒ¨æŒ‰é’® (æ‚¬åœæ—¶å˜äº®)
                    ui.button('RUN COMMAND', on_click=lambda id=tid: open_runner(id)) \
                        .style(theme.NEON_BTN + "width: 100%; border-radius: 8px;") \
                        .classes('text-sm shadow-lg')

    # åˆæ¬¡æ¸²æŸ“
    render_command_grid()
    
    # ç»‘å®šæœç´¢äº‹ä»¶
    search_input.on('change', lambda e: render_command_grid.refresh(e.value))


# =========================================
# å¼¹çª—é€»è¾‘åŒº
# =========================================
def open_runner(tid):
    data = db.get_templates().get(tid)
    if not data: return

    with ui.dialog() as dialog, ui.card().style(theme.GLASS_CARD + "min-width: 500px; border: 1px solid #3B82F6;"):
        # å¼¹çª—æ ‡é¢˜
        with ui.row().classes('w-full items-center gap-2 mb-4'):
            ui.icon('rocket_launch', color='blue').classes('text-2xl')
            ui.label(f"Execute: {data['name']}").classes('text-xl font-bold')
        
        # åŠ¨æ€è¡¨å•å®¹å™¨
        inputs = {}
        with ui.column().classes('w-full gap-3'):
            for p in data.get('params', []):
                label = p.get('label', p['name'])
                inputs[p['name']] = ui.input(label, value=p.get('default', '')) \
                    .props('dark outlined dense') \
                    .style('width: 100%;')
        
        # ç»“æœæ˜¾ç¤ºåŒº
        result_box = ui.code('Waiting for input...').classes('w-full mt-4 p-3 rounded bg-black/50 text-green-400 font-mono text-sm')

        def generate():
            try:
                # æ”¶é›†å‚æ•°å€¼
                params = {k: v.value for k, v in inputs.items()}
                res = db.render_command(data.get('template', ''), params)
                result_box.content = res
                ui.notify('Command Generated!', type='positive', color='black')
            except Exception as e:
                ui.notify(f'Error: {e}', type='negative')

        # åº•éƒ¨æŒ‰é’®æ 
        with ui.row().classes('w-full justify-end mt-6 gap-2'):
            ui.button('Close', on_click=dialog.close).props('flat color=gray')
            ui.button('Generate', on_click=generate).style(theme.NEON_BTN)

        dialog.open()


# =========================================
# å¯åŠ¨
# =========================================
# native=True å¼€å¯æœ¬åœ°çª—å£æ¨¡å¼
ui.run(title="Command Nexus", native=True, window_size=(1100, 750), reload=False)

ğŸš€ è¿è¡Œæ—¶åˆ»
 * æ‰“å¼€ä½ çš„ç»ˆç«¯ã€‚
 * è¿›å…¥ cmd_exe æ–‡ä»¶å¤¹ã€‚
 * è¿è¡Œå‘½ä»¤ï¼š
   python main.py

ä½ åº”è¯¥èƒ½çœ‹åˆ°ï¼š
ä¸€ä¸ªç‹¬ç«‹çš„æ·±è“è‰²çª—å£å¼¹å‡ºæ¥ï¼Œç•Œé¢ä¸Šæœ‰ç£¨ç ‚è´¨æ„Ÿçš„å¡ç‰‡ï¼ˆè™½ç„¶ç°åœ¨å¯èƒ½æ˜¯ç©ºçš„æˆ–è€…åªæœ‰ä¸€ä¸ªæµ‹è¯•æ•°æ®ï¼‰ï¼Œå³ä¸Šè§’æœ‰æœç´¢æ¡†ã€‚
æ³¨æ„ï¼šå› ä¸ºæ˜¯å…¨æ–°çš„æ•°æ®æ–‡ä»¶å¤¹ï¼Œä½ å¯èƒ½æš‚æ—¶çœ‹ä¸åˆ°å‘½ä»¤å¡ç‰‡ã€‚
ä½ å¯ä»¥å» cmd_exe/data/templates.json é‡Œæ‰‹åŠ¨è´´ä¸€æ®µæµ‹è¯•æ•°æ®è¿›å»çœ‹çœ‹æ•ˆæœï¼š
{
  "101": {
    "name": "Check Server Status",
    "desc": "Check the disk usage and uptime of the target server.",
    "tags": ["t1", "t3"],
    "template": "ssh user@{{ ip }} 'df -h && uptime'",
    "params": [{"name": "ip", "label": "Target IP", "default": "192.168.1.1"}]
  }
}

(ä¿å­˜jsonåï¼Œå…³æ‰ç¨‹åºé‡æ–°è¿è¡Œ python main.py)
å¿«è¯•è¯•è¿™ä¸ªæ•ˆæœï¼å‘Šè¯‰æˆ‘è¿™ä¸ª Cyberpunk ç•Œé¢ æ˜¯å¦ç¬¦åˆä½ çš„å®¡ç¾ï¼Ÿå¦‚æœæ»¡æ„ï¼Œæˆ‘ä»¬ä¸‹ä¸€æ­¥å°±åŠ ä¸Š â€œæ–°å»º/ç¼–è¾‘â€ åŠŸèƒ½ï¼Œå½»åº•è®©ä½ æ‘†è„±æ‰‹å†™ JSONã€‚
