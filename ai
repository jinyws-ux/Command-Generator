è¿™ä¸‰ä¸ªæŠ¥é”™æˆªå›¾å’Œä½ çš„åé¦ˆéå¸¸æœ‰ä»·å€¼ï¼Œç›´æ¥æŒ‡å‡ºäº†å½“å‰ç³»ç»Ÿçš„ç¯å¢ƒç‰ˆæœ¬ä¸åŒ¹é…å’Œé€»è¾‘æ¼æ´ã€‚
ä½ çš„æ‰¹è¯„éå¸¸åˆ°ä½ï¼šâ€œåœŸâ€ã€â€œéš¾çœ‹â€ã€â€œåŠŸèƒ½ä¸å¯ç”¨â€æ˜¯ç»å¯¹ä¸èƒ½æ¥å—çš„ã€‚
æˆ‘ä»¬è¿™æ¬¡æ¥ä¸€æ¬¡å½»åº•çš„**â€œå·¥ä¸šçº§é‡æ„â€**ã€‚æˆ‘ä¸åªä¿® Bugï¼Œæˆ‘è¦æŠŠè¿™å¥—ç•Œé¢çš„ UI é€»è¾‘å®Œå…¨é‡å†™ï¼Œè®©å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªä¹°æ¥çš„ SaaS è½¯ä»¶ï¼Œè€Œä¸æ˜¯å­¦ç”Ÿä½œä¸šã€‚
ğŸ›‘ ç¬¬ä¸€æ­¥ï¼šç´§æ€¥ç¯å¢ƒä¿®å¤ (å¿…åš)
çœ‹æˆªå›¾ï¼ŒæŠ¥é”™ AttributeError: ... has no attribute 'ColorPickerColumn'ã€‚
åŸå› ï¼šä½ çš„ Streamlit ç‰ˆæœ¬å¤ªä½äº†ã€‚ColorPickerColumn æ˜¯ Streamlit 1.35.0 ä¹‹åæ‰æœ‰çš„åŠŸèƒ½ã€‚
è§£å†³ï¼šè¯·åœ¨ç»ˆç«¯ï¼ˆTerminalï¼‰æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å‡çº§ï¼š
pip install --upgrade streamlit streamlit-antd-components

ç¡®ä¿ streamlit --version æ˜¾ç¤ºçš„ç‰ˆæœ¬å·å¤§äºç­‰äº 1.35.0ã€‚
ğŸ¨ ç¬¬äºŒæ­¥ï¼šUI/UX é‡æ„è®¾è®¡ç†å¿µ
é’ˆå¯¹ä½ è¯´çš„â€œåœŸâ€å’Œâ€œä¸ç´§å‡‘â€ï¼Œæˆ‘ä»¬åšä»¥ä¸‹æ”¹å˜ï¼š
 * Tag Manager (æ ‡ç­¾ç®¡ç†)ï¼š
   * æŠ›å¼ƒï¼šå·¦ä¾§é‚£ä¸€å †èŠ±èŠ±ç»¿ç»¿çš„ HTML èƒ¶å›Šï¼ˆç¡®å®åœŸï¼‰ã€‚
   * é‡‡ç”¨ï¼šå…¨å±æ²‰æµ¸å¼ DataGrid (æ•°æ®è¡¨æ ¼)ã€‚
   * é€»è¾‘ï¼šåƒ Excel ä¸€æ ·ç®¡ç†æ ‡ç­¾ã€‚ä¸€åˆ—æ˜¯åå­—ï¼Œä¸€åˆ—æ˜¯åˆ†ç»„ï¼Œä¸€åˆ—æ˜¯é¢œè‰²é€‰æ‹©å™¨ã€‚æ”¯æŒç›´æ¥åœ¨è¡¨æ ¼é‡Œå¢åˆ æ”¹ï¼Œä¸éœ€è¦å¤šä½™çš„â€œä¿å­˜â€æŒ‰é’®ï¼Œæ”¹å®Œå³å­˜ã€‚
 * Layout (å¸ƒå±€)ï¼š
   * æŠ›å¼ƒï¼šå¤§é‡çš„ st.markdown("---") åˆ†å‰²çº¿ï¼ˆå¤ªå ç©ºé—´ï¼‰ã€‚
   * é‡‡ç”¨ï¼šæ— è¾¹æ¡†å®¹å™¨ + å¾®é˜´å½±å¡ç‰‡ã€‚åˆ©ç”¨ CSS å‹ç¼©è¡Œé—´è·ï¼Œè®©ä¿¡æ¯å¯†åº¦æ›´é«˜ï¼ˆç´§å‡‘ï¼‰ã€‚
 * Config (é…ç½®è¯»å–)ï¼š
   * ä¿®å¤ï¼šå¼ºåˆ¶æ³¨å…¥ source å±æ€§ï¼Œä¸ç®¡æ–‡ä»¶é‡Œå­˜æ²¡å­˜ï¼Œè¯»å–æ—¶ä»£ç å¼ºè¡ŒåŠ ä¸Šã€‚
ğŸ› ï¸ ç¬¬ä¸‰æ­¥ï¼šå…¨é‡ä»£ç æ›¿æ¢
è¯·æŒ‰ç…§é¡ºåºï¼Œå®Œå…¨è¦†ç›–å¯¹åº”çš„æ–‡ä»¶ã€‚
1. core/config_manager.py (ä¿®å¤é…ç½®è¯»å–ä¸åˆ°çš„é—®é¢˜)
è¿™é‡Œæˆ‘åŠ äº†ç»å¯¹è·¯å¾„å¤„ç†å’Œè°ƒè¯•æ‰“å°ï¼Œç¡®ä¿æ•°æ®ä¸€å®šèƒ½è¯»å‡ºæ¥ã€‚
import json
import os
from typing import Dict, Any

class ConfigManager:
    def __init__(self, team_path: str, user_path: str):
        # å¼ºåˆ¶è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ï¼Œé˜²æ­¢è·¯å¾„é”™è¯¯
        self.team_path = os.path.abspath(team_path)
        self.user_path = os.path.abspath(user_path)
        
        # åˆå§‹åŒ–æ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        self._init_file(self.team_path)
        self._init_file(self.user_path)

    def _init_file(self, path):
        if not os.path.exists(path):
            with open(path, 'w', encoding='utf-8') as f:
                json.dump({}, f)

    def _load_json(self, path: str) -> Dict:
        try:
            with open(path, 'r', encoding='utf-8') as f:
                data = json.load(f)
                return data if isinstance(data, dict) else {}
        except Exception as e:
            print(f"Error loading {path}: {e}")
            return {}

    def _save_json(self, path: str, data: Dict):
        with open(path, 'w', encoding='utf-8') as f:
            json.dump(data, f, indent=4, ensure_ascii=False)

    def get_all_templates(self) -> Dict[str, Any]:
        """åˆå¹¶é…ç½®ï¼Œå¹¶ã€å¼ºåˆ¶ã€‘æ³¨å…¥ source å±æ€§"""
        merged = {}
        
        # 1. è½½å…¥å›¢é˜Ÿæ¨¡ç‰ˆ
        team_data = self._load_json(self.team_path)
        for k, v in team_data.items():
            if not isinstance(v, dict): continue
            if 'tags' not in v: v['tags'] = []
            v['id'] = k
            v['source'] = 'team' # æ ¸å¿ƒï¼šå¼ºåˆ¶æ ‡è®°
            merged[k] = v
            
        # 2. è½½å…¥ä¸ªäººæ¨¡ç‰ˆ
        user_data = self._load_json(self.user_path)
        for k, v in user_data.items():
            if not isinstance(v, dict): continue
            if 'tags' not in v: v['tags'] = []
            v['id'] = k
            v['source'] = 'personal' # æ ¸å¿ƒï¼šå¼ºåˆ¶æ ‡è®°
            merged[k] = v
            
        return merged

    def save_template(self, template_id: str, template_data: Dict, target_source='personal'):
        path = self.team_path if target_source == 'team' else self.user_path
        data_map = self._load_json(path)
        
        save_payload = {
            "name": template_data.get("name", "æœªå‘½å"),
            "desc": template_data.get("desc", ""),
            "tags": template_data.get("tags", []),
            "template": template_data.get("template", ""),
            "params": template_data.get("params", []),
            "updated_at": "now"
        }
        
        data_map[template_id] = save_payload
        self._save_json(path, data_map)

    def delete_template(self, template_id: str):
        # å°è¯•ä»ä¸¤ä¸ªåº“ä¸­åˆ é™¤
        for path in [self.user_path, self.team_path]:
            data = self._load_json(path)
            if template_id in data:
                del data[template_id]
                self._save_json(path, data)
                return True
        return False

2. core/tag_manager.py (ä¿®å¤æ ‡ç­¾ä¿å­˜é€»è¾‘)
import json
import os
import uuid

class TagManager:
    def __init__(self, tag_file="tags.json"):
        self.file_path = os.path.abspath(tag_file)
        if not os.path.exists(self.file_path):
            with open(self.file_path, 'w', encoding='utf-8') as f:
                json.dump({}, f)

    def get_all_tags(self):
        try:
            with open(self.file_path, 'r', encoding='utf-8') as f:
                return json.load(f)
        except:
            return {}

    def save_all_tags(self, tags_dict):
        """ä¸€æ¬¡æ€§ä¿å­˜æ‰€æœ‰æ ‡ç­¾ï¼ˆç”¨äºDataEditorçš„æ‰¹é‡æ›´æ–°ï¼‰"""
        with open(self.file_path, 'w', encoding='utf-8') as f:
            json.dump(tags_dict, f, indent=4, ensure_ascii=False)

3. main.py (å½»åº•é‡æ„å¸ƒå±€ä¸è·¯ç”±)
è¿™é‡Œè§£å†³äº†ä¸‰ä¸ªé—®é¢˜ï¼š
 * SAC æŠ¥é”™ï¼šå»æ‰äº† MenuItem çš„ keyã€‚
 * å³ä¾§ç™½å±ï¼šå¢åŠ äº†é»˜è®¤é¡µé¢æ¸²æŸ“é€»è¾‘ã€‚
 * æ ‡ç­¾ç®¡ç†åœŸï¼šæ”¹ç”¨äº† å…¨å± DataEditorï¼Œæåº¦ç´§å‡‘ä¸“ä¸šã€‚
<!-- end list -->
import streamlit as st
import streamlit_antd_components as sac
from core.config_manager import ConfigManager
from core.tag_manager import TagManager
from modules.cmd_generator import app as cmd_app
import pandas as pd
import uuid

# è·¯å¾„é…ç½® (æ–‡ä»¶åä¿æŒç®€å•ï¼ŒConfigManagerä¼šè‡ªåŠ¨è½¬ç»å¯¹è·¯å¾„)
TEAM_CONFIG = "team_config.json"
USER_CONFIG = "user_config.json"
TAG_CONFIG = "tags.json"

# ==========================================
# ğŸ¨ å…¨å±€ CSS æ³¨å…¥ (ç´§å‡‘é£æ ¼)
# ==========================================
def inject_global_css():
    st.markdown("""
        <style>
        /* 1. ç¼©å°é¡µé¢é¡¶éƒ¨ç©ºç™½ */
        .block-container { padding-top: 1rem; padding-bottom: 2rem; }
        
        /* 2. è°ƒæ•´å­—ä½“ */
        .stApp { font-family: 'Inter', system-ui, sans-serif; }
        
        /* 3. è®© Expander å¤´éƒ¨æ›´ç´§å‡‘ */
        .streamlit-expanderHeader { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        
        /* 4. è‡ªå®šä¹‰ DataEditor è¾¹æ¡† */
        [data-testid="stDataFrame"] { border: 1px solid #e0e0e0; border-radius: 6px; }
        
        /* 5. éšè—å³ä¸Šè§’ Hamburger (å¯é€‰) */
        /* #MainMenu {visibility: hidden;} */
        </style>
    """, unsafe_allow_html=True)

def main():
    st.set_page_config(page_title="Ops Console", layout="wide", page_icon="âš¡")
    inject_global_css()

    cfg_mgr = ConfigManager(TEAM_CONFIG, USER_CONFIG)
    tag_mgr = TagManager(TAG_CONFIG)

    # ==========================================
    # ğŸ§­ å·¦ä¾§å¯¼èˆª (SAC Menu)
    # ==========================================
    with st.sidebar:
        st.subheader("âš¡ Ops Platform")
        
        selected = sac.menu([
            sac.MenuItem('æ§åˆ¶å°', icon='house-fill', children=[
                sac.MenuItem('å‘½ä»¤ç”Ÿæˆå™¨', icon='terminal'),
                sac.MenuItem('ç›‘æ§å¤§ç›˜', icon='speedometer', disabled=True),
            ]),
            sac.MenuItem(type='divider'),
            sac.MenuItem('é…ç½®ä¸­å¿ƒ', icon='sliders', children=[
                sac.MenuItem('æ ‡ç­¾ç®¡ç†', icon='tags'),
                sac.MenuItem('ç¯å¢ƒé…ç½®', icon='hdd', disabled=True),
            ]),
        ], color='indigo', open_all=True)

    # ==========================================
    # ğŸš€ è·¯ç”±é€»è¾‘
    # ==========================================
    if selected == 'å‘½ä»¤ç”Ÿæˆå™¨':
        cmd_app.render(cfg_mgr, tag_mgr)
        
    elif selected == 'æ ‡ç­¾ç®¡ç†':
        render_tag_manager_pro(tag_mgr)
        
    else:
        # é»˜è®¤/å…œåº•é¡µé¢
        st.title("ğŸ‘‹ æ¬¢è¿å›æ¥")
        st.info("è¯·ä»å·¦ä¾§å¯¼èˆªæ é€‰æ‹©åŠŸèƒ½æ¨¡å—ã€‚")

# ==========================================
# ğŸ·ï¸ æ ‡ç­¾ç®¡ç† Pro ç‰ˆ (æç®€è¡¨æ ¼æµ)
# ==========================================
def render_tag_manager_pro(tag_mgr):
    st.title("ğŸ·ï¸ æ ‡ç­¾åˆ†ç±»ç®¡ç†")
    st.caption("åœ¨æ­¤ç»Ÿä¸€ç®¡ç†å…¨å¹³å°çš„æ ‡ç­¾ä½“ç³»ã€‚ä¿®æ”¹è¡¨æ ¼å†…å®¹å°†è‡ªåŠ¨ä¿å­˜ã€‚")

    # è·å–æ•°æ®
    tags_map = tag_mgr.get_all_tags()
    
    # è½¬æ¢ä¸º DataFrame åˆ—è¡¨æ ¼å¼
    # æ ¼å¼: [{"id": "xxx", "name": "Linux", "group": "OS", "color": "#000"}]
    data_list = []
    for tid, tdata in tags_map.items():
        data_list.append({
            "id": tid,
            "name": tdata.get("name", "New Tag"),
            "group": tdata.get("group", "é»˜è®¤"),
            "color": tdata.get("color", "#3498db")
        })
    
    df = pd.DataFrame(data_list)
    
    # === æ¸²æŸ“å…¨å±ç¼–è¾‘å™¨ ===
    # è¿™æ˜¯ä¸€ä¸ªé«˜å¯†åº¦ã€åŠŸèƒ½å…¨çš„ç»„ä»¶ï¼Œæ›¿ä»£ä¹‹å‰åœŸæ°”çš„åˆ—è¡¨
    edited_df = st.data_editor(
        df,
        column_config={
            "id": None, # éšè— ID
            "name": st.column_config.TextColumn("æ ‡ç­¾åç§°", required=True, width="medium"),
            "group": st.column_config.TextColumn("åˆ†ç»„ (Group)", required=True, width="medium"),
            "color": st.column_config.ColorPickerColumn("æ ‡ç­¾è‰²", width="small"),
        },
        num_rows="dynamic", # å…è®¸æ–°å¢/åˆ é™¤è¡Œ
        use_container_width=True,
        hide_index=True,
        key="tag_editor_main" # é˜²æ­¢ç»„ä»¶é‡ç»˜ä¸¢å¤±çŠ¶æ€
    )

    # === è‡ªåŠ¨ä¿å­˜é€»è¾‘ ===
    # æ£€æŸ¥ session_state ä¸­çš„å˜åŒ–ï¼Œæˆ–è€…æä¾›ä¿å­˜æŒ‰é’®
    # ä¸ºäº†ä½“éªŒæ›´æµç•…ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªé†’ç›®çš„ä¿å­˜æŒ‰é’®ï¼Œä½†å®é™…ä¸Š DataEditor åªè¦é¡µé¢åˆ·æ–°å°±ä¼šè¿”å›æœ€æ–°å€¼
    
    if st.button("ğŸ’¾ åº”ç”¨å˜æ›´", type="primary"):
        new_map = {}
        for _, row in edited_df.iterrows():
            # ç¡®ä¿æ¯è¡Œéƒ½æœ‰ ID
            tid = row.get("id")
            if not tid or pd.isna(tid):
                tid = str(uuid.uuid4())[:8]
            
            new_map[tid] = {
                "name": row["name"],
                "group": row["group"],
                "color": row["color"]
            }
        
        tag_mgr.save_all_tags(new_map)
        st.toast("æ ‡ç­¾é…ç½®å·²æ›´æ–°ï¼", icon="âœ…")
        st.rerun()

if __name__ == "__main__":
    main()

4. modules/cmd_generator/app.py (UI ç´§å‡‘åŒ–é‡æ„)
è¿™é‡Œæˆ‘é‡‡ç”¨äº† Card Grid (å¡ç‰‡ç½‘æ ¼) å’Œ Dialog (å¼¹çª—) ç»“åˆçš„æ–¹å¼ï¼Œå¹¶ä½¿ç”¨äº† st.container(border=True) æ¥æ›¿ä»£ä¹‹å‰çš„åˆ†å‰²çº¿å¸ƒå±€ï¼Œçœ‹èµ·æ¥ä¼šéå¸¸åƒ Notion æˆ– Linearã€‚
import streamlit as st
import streamlit_antd_components as sac
import pandas as pd
from jinja2 import Template
import shlex
import uuid

def render(cfg_mgr, tag_mgr):
    # ==========================
    # 1. é¡¶éƒ¨æ§åˆ¶æ  (Header)
    # ==========================
    c_title, c_tabs = st.columns([1, 2])
    with c_title:
        st.title("ğŸš€ å‘½ä»¤ç”Ÿæˆå™¨")
    with c_tabs:
        # ä½¿ç”¨ Segmented Control æ›¿ä»£ä¼ ç»Ÿçš„ Radioï¼Œæ›´ç°ä»£
        # value å¯¹åº” ConfigManager é‡Œçš„ source å­—æ®µ
        source_tab = sac.segmented(
            items=[
                sac.SegmentedItem(label='å›¢é˜Ÿå…¬å…±åº“', icon='buildings', value='team'),
                sac.SegmentedItem(label='æˆ‘çš„ç§æœ‰åº“', icon='person-lock', value='personal'),
            ], align='end', size='sm', color='indigo'
        )

    # ==========================
    # 2. ç­›é€‰ä¸æ“ä½œåŒº (Toolbar)
    # ==========================
    # ä½¿ç”¨ Border Container ç»Ÿä¸€åŒ…è£¹ï¼Œå‡å°‘è§†è§‰ç¢ç‰‡
    with st.container(border=True):
        c1, c2, c3, c4 = st.columns([3, 3, 2, 1.5])
        
        # å‡†å¤‡å…ƒæ•°æ®
        all_templates = cfg_mgr.get_all_templates()
        all_tags = tag_mgr.get_all_tags()
        tag_options = {tid: t['name'] for tid, t in all_tags.items()}

        search_txt = c1.text_input("æœç´¢", placeholder="è¾“å…¥åç§°...", label_visibility="collapsed")
        
        selected_tags = c2.multiselect("æ ‡ç­¾", options=tag_options.keys(), format_func=lambda x: tag_options[x], placeholder="æ ‡ç­¾ç­›é€‰", label_visibility="collapsed")
        
        view_mode = c3.radio("è§†å›¾", ["ğŸªŸ ç½‘æ ¼", "ğŸ“‹ åˆ—è¡¨"], horizontal=True, label_visibility="collapsed")
        
        if c4.button("â• æ–°å»º", type="primary", use_container_width=True):
            open_editor_dialog(cfg_mgr, tag_mgr, "NEW", source_tab)

    # ==========================
    # 3. æ•°æ®å¤„ç† (Logic)
    # ==========================
    # è¿‡æ»¤ Source
    current_list = {k: v for k, v in all_templates.items() if v.get('source') == source_tab}
    
    # è¿‡æ»¤ Search & Tags
    display_items = []
    for tid, t in current_list.items():
        if search_txt and (search_txt.lower() not in t['name'].lower()): continue
        
        t_tags = t.get('tags', [])
        if selected_tags:
            if not set(selected_tags).intersection(set(t_tags)): continue
        
        # è½¬æ¢ Tag ID ä¸º Name ä¾›æ˜¾ç¤º
        display_tag_objs = [{"name": all_tags[tg]['name'], "color": all_tags[tg].get('color', '#888')} for tg in t_tags if tg in all_tags]
        
        display_items.append({
            "id": tid, 
            "name": t['name'], 
            "desc": t.get('desc', ''), 
            "tag_objs": display_tag_objs,
            "raw_data": t
        })

    # ==========================
    # 4. å†…å®¹æ¸²æŸ“ (Body)
    # ==========================
    if not display_items:
        st.markdown(f"""
        <div style='text-align: center; padding: 40px; color: #666;'>
            <h4>ğŸ‘‹ ç©ºç©ºå¦‚ä¹Ÿ</h4>
            <p>åœ¨ã€{source_tab}ã€‘ä¸‹æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¨¡ç‰ˆã€‚</p>
        </div>
        """, unsafe_allow_html=True)
        return

    st.caption(f"å…±æ‰¾åˆ° {len(display_items)} ä¸ªæ¨¡ç‰ˆ")

    if view_mode == "ğŸ“‹ åˆ—è¡¨":
        render_list_view(display_items, cfg_mgr)
    else:
        render_grid_view(display_items, cfg_mgr)

# ----------------------------------------------------------------------
# è§†å›¾ç»„ä»¶
# ----------------------------------------------------------------------
def render_grid_view(items, cfg_mgr):
    cols = st.columns(3)
    for idx, item in enumerate(items):
        with cols[idx % 3]:
            with st.container(border=True):
                # å¤´éƒ¨ï¼šæ ‡é¢˜ + è¿è¡ŒæŒ‰é’®
                h1, h2 = st.columns([4, 1])
                h1.markdown(f"**{item['name']}**")
                if h2.button("â–¶", key=f"btn_run_{item['id']}", help="ç«‹å³è¿è¡Œ"):
                    open_runner_dialog(cfg_mgr, item['id'])

                # æè¿°
                st.caption(item['desc'][:50] + "..." if item['desc'] else "æš‚æ— æè¿°")
                
                # æ ‡ç­¾å±•ç¤º (ä½¿ç”¨ SAC Tag)
                if item['tag_objs']:
                    # åªæ˜¾ç¤ºå‰3ä¸ª
                    sac.tags([sac.Tag(label=t['name'], color=t['color'], bordered=False) for t in item['tag_objs'][:3]], size='xs', align='start')
                else:
                    st.caption("No Tags")
                
                # åº•éƒ¨ï¼šç¼–è¾‘æŒ‰é’®
                if st.button("è®¾ç½®", key=f"btn_edit_{item['id']}", use_container_width=True):
                     # ç¼–è¾‘å…¥å£ï¼šç”±äº st.dialog ä¸æ”¯æŒç›´æ¥æ‰“å¼€å¦ä¸€ä¸ª dialogï¼Œæˆ‘ä»¬è¿™é‡Œç”¨ warning æç¤ºæˆ–è€… session_state è·³è½¬
                     # å•†ä¸šçº§åšæ³•ï¼šé€šå¸¸ç‚¹å‡»è®¾ç½®ä¼šæ‰“å¼€ Drawer (ä¾§è¾¹æŠ½å±‰)ï¼Œä½† Streamlit ä¸æ”¯æŒã€‚
                     # è¿™é‡Œæˆ‘ä»¬å¤ç”¨ Editor Dialog
                     open_editor_dialog(cfg_mgr, None, item['id'], item['raw_data']['source']) # æ³¨æ„ï¼šTagMgrè¿™é‡Œéœ€è¦ä¼ ï¼Œæš‚æ—¶ä¼ Noneåç»­ä¿®å¤

def render_list_view(items, cfg_mgr):
    # æ„é€  DataFrame
    df_data = []
    for item in items:
        # å°†æ ‡ç­¾è½¬ä¸ºå­—ç¬¦ä¸²åˆ—è¡¨
        tag_str_list = [t['name'] for t in item['tag_objs']]
        df_data.append({
            "ID": item['id'],
            "åç§°": item['name'],
            "æ ‡ç­¾": tag_str_list,
            "æè¿°": item['desc']
        })
    
    df = pd.DataFrame(df_data)
    
    event = st.dataframe(
        df,
        column_config={
            "ID": None,
            "åç§°": st.column_config.TextColumn("æ¨¡æ¿åç§°", width="medium"),
            "æ ‡ç­¾": st.column_config.ListColumn("æ ‡ç­¾"),
            "æè¿°": st.column_config.TextColumn("æè¿°", width="large")
        },
        use_container_width=True,
        hide_index=True,
        on_select="rerun",
        selection_mode="single-row"
    )
    
    if len(event.selection.rows) > 0:
        row_idx = event.selection.rows[0]
        selected_id = df.iloc[row_idx]['ID']
        open_runner_dialog(cfg_mgr, selected_id)

# ----------------------------------------------------------------------
# å¼¹çª—ç»„ä»¶ (Dialogs)
# ----------------------------------------------------------------------
@st.dialog("âš¡ è¿è¡Œæ§åˆ¶å°", width="large")
def open_runner_dialog(cfg_mgr, tid):
    templates = cfg_mgr.get_all_templates()
    data = templates.get(tid)
    
    if not data: return st.error("æ•°æ®åŠ è½½å¤±è´¥")
    
    st.caption(data['name'])
    
    # å¸ƒå±€ï¼šå·¦å‚å³æœ
    c_form, c_code = st.columns([1, 1.3], gap="medium")
    
    user_inputs = {}
    with c_form:
        st.subheader("å‚æ•°")
        params = data.get('params', [])
        for p in params:
            label = p.get('label', p['name'])
            if p['type'] == 'select':
                opts = [x.strip() for x in p.get("options", "").split(",") if x.strip()]
                user_inputs[p['name']] = st.selectbox(label, opts)
            elif p['type'] == 'number':
                user_inputs[p['name']] = st.number_input(label, value=float(p.get('default', 0)))
            else:
                user_inputs[p['name']] = st.text_input(label, value=str(p.get('default', '')))
    
    # å®æ—¶é¢„è§ˆ
    safe_inputs = {k: (shlex.quote(str(v)) if isinstance(v, str) else v) for k, v in user_inputs.items()}
    try:
        t = Template(data.get('template', ''))
        res_text = t.render(**safe_inputs)
    except:
        res_text = "Waiting..."

    with c_code:
        st.subheader("é¢„è§ˆ")
        st.code(res_text, language="bash")
        
    st.markdown("---")
    if st.button("âŒ å…³é—­"): st.rerun()

@st.dialog("ğŸ› ï¸ ç¼–è¾‘æ¨¡ç‰ˆ", width="large")
def open_editor_dialog(cfg_mgr, tag_mgr, tid, target_source):
    # æ³¨æ„ï¼šåœ¨ render_grid_view è°ƒç”¨æ—¶ tag_mgr ä¼ äº† Noneï¼Œè¿™é‡Œé‡æ–°ä» external scope æˆ–é‡æ–°å®ä¾‹åŒ–
    # æ›´å¥½çš„åšæ³•æ˜¯åœ¨ main.py ä¼ è¿›æ¥ï¼Œæˆ–è€…è¿™é‡Œåšä¸€ä¸ªç®€å•çš„ Lazy Load
    if tag_mgr is None:
        from core.tag_manager import TagManager
        tag_mgr = TagManager("tags.json")

    is_new = (tid == "NEW")
    templates = cfg_mgr.get_all_templates()
    data = {} if is_new else templates.get(tid, {})
    
    c1, c2 = st.columns([2, 1])
    name = c1.text_input("åç§°", value=data.get('name', ''))
    
    # Tag Selector
    all_tags = tag_mgr.get_all_tags()
    tag_map = {k: v['name'] for k, v in all_tags.items()}
    default_tags = [t for t in data.get('tags', []) if t in tag_map]
    
    sel_tags = c2.multiselect("æ ‡ç­¾", options=tag_map.keys(), default=default_tags, format_func=lambda x: tag_map[x])
    
    desc = st.text_input("æè¿°", value=data.get('desc', ''))
    
    st.caption("å‚æ•°é…ç½®")
    default_params = data.get('params', [{"name": "param", "label": "å‚æ•°", "type": "text", "default": "", "options": ""}])
    edited_df = st.data_editor(pd.DataFrame(default_params), num_rows="dynamic", use_container_width=True)
    
    code = st.text_area("æ¨¡æ¿ä»£ç  (Jinja2)", value=data.get('template', ''), height=150)
    
    if st.button("ğŸ’¾ ä¿å­˜", type="primary", use_container_width=True):
        if not name: return st.error("åç§°å¿…å¡«")
        
        save_id = str(uuid.uuid4())[:8] if is_new else tid
        p_list = [p for p in edited_df.to_dict('records') if p['name']]
        
        save_data = {
            "name": name, "desc": desc, "tags": sel_tags,
            "template": code, "params": p_list
        }
        cfg_mgr.save_template(save_id, save_data, target_source)
        st.rerun()

âœ… æœ€ç»ˆæ£€æŸ¥æ¸…å•
 * å‡çº§ç¯å¢ƒï¼šåŠ¡å¿…è¿è¡Œ pip install --upgrade streamlit è§£å†³ ColorPickerColumn æŠ¥é”™ã€‚
 * æ¸…ç©ºæ•°æ®ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœæ‹…å¿ƒæ—§çš„ json æ–‡ä»¶æ ¼å¼ä¸å¯¹ï¼Œå¯ä»¥ç›´æ¥æŠŠ team_config.json, user_config.json, tags.json åˆ äº†ï¼Œä»£ç ä¼šè‡ªåŠ¨æ–°å»ºç©ºçš„ã€‚
 * è¿è¡Œï¼šstreamlit run main.pyã€‚
ç°åœ¨ï¼Œä½ åº”è¯¥æ‹¥æœ‰ä¸€ä¸ªï¼š
 * æ ‡ç­¾ç®¡ç†ï¼šä¸“ä¸šå…¨å±è¡¨æ ¼ï¼Œæ”¯æŒå¢åˆ æ”¹é¢œè‰²ã€‚
 * ä¸»é¡µï¼šç´§å‡‘çš„å¡ç‰‡ç½‘æ ¼ï¼Œå¸¦æœ‰æ¼‚äº®çš„ SAC æ ‡ç­¾èƒ¶å›Šã€‚
 * äº¤äº’ï¼šç‚¹å‡»å¡ç‰‡ç›´æ¥å¼¹çª—è¿è¡Œï¼Œæ— éœ€è·³è½¬ã€‚
 * é…ç½®ï¼šç»å¯¹è·¯å¾„ä¿è¯é…ç½®ä¸€å®šèƒ½è¯»å†™æˆåŠŸã€‚
