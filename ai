æ—¢ç„¶ä½ æåˆ°äº† â€œä¸ä¸€å®šè¦èµ›åšï¼Œä½†è¦æœ‹å…‹â€ï¼Œè€Œä¸”è¦ â€œæ–°æ½®åˆå¥½ç”¨â€ï¼Œæˆ‘è„‘æµ·é‡Œç«‹åˆ»æµ®ç°å‡ºä¸€ç§ç°åœ¨è®¾è®¡ç•Œéå¸¸ç«çš„é£æ ¼ï¼šæ–°é‡å…½æ´¾ (Neo-Brutalism)ã€‚
è¿™ç§é£æ ¼å®Œç¾å¥‘åˆä½ çš„è¦æ±‚ï¼š
 * æœ‹å…‹ (Punk)ï¼šå®ƒåå¯¹æç®€ä¸»ä¹‰çš„â€œæ€§å†·æ·¡é£â€ï¼Œä½¿ç”¨ç²—é»‘è¾¹æ¡†ã€é«˜é¥±å’Œåº¦æ’è‰²ã€ç¡¬æœ—çš„æŠ•å½±ã€‚
 * æ–°æ½® (Trendy)ï¼šè¿™æ˜¯ç›®å‰ Figmaã€Gumroad ç­‰å‰æ²¿ç§‘æŠ€å…¬å¸æœ€çˆ±ç”¨çš„è®¾è®¡è¯­è¨€ã€‚
 * å¥½ç”¨ (Usable)ï¼šå®ƒçš„æŒ‰é’®åƒå®ä½“ç§¯æœ¨ä¸€æ ·ï¼Œç‚¹å‡»æ„Ÿæå¼ºï¼Œè¾¹ç•Œåˆ†æ˜ï¼Œç»ä¸ä¼šè¯¯è§¦ã€‚
æˆ‘ä»¬æŠŠå®ƒå‘½åä¸º "Pop-Industrial" (æ³¢æ™®å·¥ä¸šé£)ã€‚
è¯·å‡†å¤‡å¥½ï¼Œæˆ‘ä»¬è¦æŠŠä½ çš„è½¯ä»¶ä»â€œæš—é»‘é»‘å®¢å±‹â€æ”¹é€ æˆä¸€ä¸ª â€œå‰å«è®¾è®¡å·¥ä½œå®¤â€ã€‚
ğŸ¨ ç¬¬ä¸€æ­¥ï¼šé‡å†™çš®è‚¤ (theme.py)
è¿™æ¬¡æˆ‘ä»¬æŠ›å¼ƒç£¨ç ‚ç»ç’ƒï¼Œæ”¹ç”¨ç¡¬è¾¹æ¡†ã€ç¡¬æŠ•å½±ã€åƒç´ ç‚¹é˜µèƒŒæ™¯ã€‚
è¯·å®Œå…¨è¦†ç›– cmd_exe/theme.pyï¼š
# theme.py
from nicegui import ui

# --- æ ¸å¿ƒé…è‰² (Neo-Brutalism Palette) ---
BG_COLOR = "#F0F0F0"       # æµ…ç°åº•è‰²ï¼Œåƒæœªæ¼‚ç™½çš„çº¸
PRIMARY = "#8B5CF6"        # æœ‹å…‹ç´«
ACCENT_TEAL = "#2DD4BF"    # è§å…‰é’
ACCENT_PINK = "#FB7185"    # è§å…‰ç²‰
ACCENT_YELLOW = "#FBBF24"  # è­¦ç¤ºé»„
TEXT_MAIN = "#18181B"      # ææ·±ç°ï¼ˆä»£æ›¿çº¯é»‘ï¼‰

# --- æ ·å¼å¸¸é‡ ---

# 1. é‡å…½æ´¾å¡ç‰‡ (ç¡¬è¾¹æ¡† + ç¡¬é˜´å½±)
# box-shadow: Xåç§» Yåç§» æ¨¡ç³Š é¢œè‰²
BRUTAL_CARD = (
    "background-color: white; "
    "border: 2px solid #000000; "        # 2px çº¯é»‘ç²—è¾¹æ¡†
    "border-radius: 8px; "
    "box-shadow: 4px 4px 0px 0px #000000; " # ç¡¬é˜´å½±ï¼Œä¸æ¨¡ç³Š
    "transition: all 0.1s ease-in-out; "
)

# 2. æ³¢æ™®æŒ‰é’® (ç‚¹å‡»æ—¶ä¼šæœ‰æŒ‰å‹ä¸‹å»çš„æ•ˆæœ)
# æˆ‘ä»¬ä¼šåœ¨ä»£ç é‡ŒåŠ¨æ€åŠ  active:translate æ•ˆæœ
BRUTAL_BTN = (
    "border: 2px solid #000000; "
    "border-radius: 6px; "
    "font-weight: 800; " # è¶…ç²—å­—ä½“
    "text-transform: uppercase; " # å…¨å¤§å†™
    "box-shadow: 2px 2px 0px 0px #000000; "
    "color: black; "
)

# 3. å¤å¤è¾“å…¥æ¡†
BRUTAL_INPUT = (
    "background-color: white; "
    "border: 2px solid #000000; "
    "border-radius: 6px; "
    "padding: 4px 8px; "
    "color: black; "
)

def setup_global_theme():
    """åº”ç”¨å…¨å±€æ ·å¼"""
    # è¿™æ¬¡æˆ‘ä»¬ç”¨äº®è‰²æ¨¡å¼ï¼Œå› ä¸ºé‡å…½æ´¾é€šå¸¸æ˜¯ç™½åº•é»‘å­—
    # ui.dark_mode().disable() # é»˜è®¤å°±æ˜¯äº®è‰²ï¼Œä¸éœ€è¦å¼ºåˆ¶
    
    # æ³¨å…¥å…¨å±€ CSS
    ui.add_head_html(f'''
        <style>
            @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Space+Grotesk:wght@300;500;700&display=swap');
            
            body {{
                background-color: {BG_COLOR};
                /* ç‚¹é˜µèƒŒæ™¯å›¾ï¼Œå¢åŠ å·¥ä¸šæ„Ÿ */
                background-image: radial-gradient(#000 1px, transparent 1px);
                background-size: 20px 20px;
                color: {TEXT_MAIN};
                font-family: 'Space Grotesk', sans-serif; /* è¿™ç§å­—ä½“éå¸¸æœ‰ç§‘æŠ€æ„Ÿ */
            }}
            
            /* è¿™ç§é£æ ¼çš„ä»£ç å—æ ·å¼ */
            .q-badge {{ border: 1px solid black; }}
            
            /* æŒ‰é’®æŒ‰ä¸‹å»çš„å¾®äº¤äº’ */
            .brutal-btn:active {{
                transform: translate(2px, 2px);
                box-shadow: 0px 0px 0px 0px #000000 !important;
            }}
        </style>
    ''')

ğŸ¦´ ç¬¬äºŒæ­¥ï¼šé‡æ„éª¨æ¶ (main.py)
è¿™æ¬¡æˆ‘ä»¬ä¸ä»…æ¢äº†çš®ï¼Œè¿˜æŠŠ**â€œæ–°å»ºå‘½ä»¤â€å’Œâ€œç¼–è¾‘åŠŸèƒ½â€**åŠ ä¸Šäº†ã€‚ç•Œé¢å¸ƒå±€ä½¿ç”¨äº†æ›´åŠ æ´»æ³¼çš„ Masonry (ç€‘å¸ƒæµ) æ„Ÿè§‰ã€‚
è¯·å®Œå…¨è¦†ç›– cmd_exe/main.pyï¼š
# main.py
from nicegui import ui, app
from logic import db
import theme
import uuid

# åº”ç”¨çš®è‚¤
theme.setup_global_theme()

# =========================================
# ç»„ä»¶å®šä¹‰ (ä¸ºäº†ä»£ç å¤ç”¨)
# =========================================
def brutal_button(text, icon=None, color="#FFFFFF", on_click=None):
    """å°è£…ä¸€ä¸ªé‡å…½æ´¾æŒ‰é’®"""
    btn = ui.button(text, icon=icon, on_click=on_click) \
        .style(theme.BRUTAL_BTN + f"background-color: {color};") \
        .classes('brutal-btn text-black')
    return btn

def tag_badge(text, color_hex):
    """é‡å…½æ´¾æ ‡ç­¾"""
    return ui.label(text).style(
        f"background-color: {color_hex}; border: 1px solid black; box-shadow: 2px 2px 0 black;"
    ).classes('px-2 py-0.5 text-xs font-bold rounded-full')

# =========================================
# æ ¸å¿ƒç•Œé¢
# =========================================

# --- é¡¶æ  ---
with ui.header().classes('bg-transparent q-py-lg mb-4'):
    with ui.row().classes('w-full max-w-6xl mx-auto items-end justify-between px-4'):
        # LOGO
        with ui.row().classes('items-center gap-0'):
            ui.label('CMD').style('font-family: "JetBrains Mono"; font-weight: 800; background: black; color: white; padding: 4px 8px; font-size: 24px;')
            ui.label('NEXUS').style('font-family: "JetBrains Mono"; font-weight: 800; border: 3px solid black; background: white; color: black; padding: 4px 8px; font-size: 24px;')
        
        # æœç´¢ä¸æ“ä½œ
        with ui.row().classes('gap-4 items-center'):
            search_input = ui.input(placeholder='SEARCH_COMMANDS') \
                .props('outlined dense') \
                .style(theme.BRUTAL_INPUT + "box-shadow: 4px 4px 0 black; width: 240px;")
            
            brutal_button('NEW COMMAND', icon='add', color=theme.ACCENT_TEAL, on_click=lambda: open_editor())

# --- ä¸»å†…å®¹åŒº ---
with ui.element('div').classes('w-full max-w-6xl mx-auto px-4 pb-20'):
    
    @ui.refreshable
    def render_grid(filter_text=""):
        templates = db.get_templates()
        
        if not templates:
            with ui.column().classes('w-full items-center py-20'):
                ui.label('EMPTY_SYSTEM').classes('text-4xl font-black text-gray-400')
                ui.label('Create your first protocol now.').classes('font-mono mt-2')
            return

        # ç€‘å¸ƒæµå¸ƒå±€
        with ui.grid().classes('grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8'):
            
            for tid, t in templates.items():
                if filter_text and filter_text.lower() not in t['name'].lower(): continue
                
                # === å¡ç‰‡æœ¬ä½“ ===
                with ui.card().style(theme.BRUTAL_CARD).classes('relative group hover:-translate-y-1 cursor-default'):
                    
                    # è£…é¥°æ€§æ ‡é¢˜æ 
                    with ui.row().classes('w-full border-b-2 border-black pb-2 mb-3 justify-between bg-yellow-50 -mx-4 -mt-4 px-4 pt-3 rounded-t-lg'):
                        ui.label(t['name']).classes('font-bold text-lg font-mono')
                        # ç¼–è¾‘æŒ‰é’® (å°)
                        ui.button(icon='edit', on_click=lambda id=tid: open_editor(id)) \
                            .props('flat dense round color=black size=sm')

                    # æè¿°
                    ui.label(t.get('desc', '-')).classes('text-sm text-gray-600 mb-4 h-10 line-clamp-2')

                    # æ ‡ç­¾åŒº
                    with ui.row().classes('gap-2 mb-4'):
                        # éšä¾¿æç‚¹é¢œè‰²é€»è¾‘ï¼Œæˆ–è€…ä»tagsé‡Œå–
                        ui.label('PROD').style('border: 1px solid black; background: #FB7185; box-shadow: 1px 1px 0 black;').classes('px-1 text-[10px] font-bold')
                        ui.label('SSH').style('border: 1px solid black; background: #2DD4BF; box-shadow: 1px 1px 0 black;').classes('px-1 text-[10px] font-bold')

                    # åº•éƒ¨å¤§æŒ‰é’®
                    brutal_button('EXECUTE', icon='play_arrow', color=theme.ACCENT_YELLOW, on_click=lambda id=tid: open_runner(id)) \
                        .classes('w-full')

    render_grid()
    search_input.on('change', lambda e: render_grid.refresh(e.value))


# =========================================
# å¼¹çª—é€»è¾‘ (Editor & Runner)
# =========================================

# --- ç¼–è¾‘å™¨å¼¹çª— ---
def open_editor(tid=None):
    is_edit = tid is not None
    data = db.get_templates().get(tid, {}) if is_edit else {}
    
    with ui.dialog() as dialog, ui.card().style(theme.BRUTAL_CARD + "min-width: 600px; padding: 0;"):
        # å¼¹çª—å¤´
        with ui.row().classes('w-full bg-black p-4 justify-between items-center'):
            ui.label('EDIT_PROTOCOL' if is_edit else 'NEW_PROTOCOL').classes('text-white font-mono font-bold text-xl')
            ui.button(icon='close', on_click=dialog.close).props('flat dense color=white')
        
        # å¼¹çª—ä½“
        with ui.column().classes('p-6 w-full gap-4'):
            name = ui.input('NAME', value=data.get('name', '')).props('outlined dense').style(theme.BRUTAL_INPUT).classes('w-full')
            desc = ui.input('DESCRIPTION', value=data.get('desc', '')).props('outlined dense').style(theme.BRUTAL_INPUT).classes('w-full')
            
            ui.label('TEMPLATE CODE (Jinja2)').classes('font-bold mt-2')
            code = ui.textarea(value=data.get('template', '')).props('outlined dense').style(theme.BRUTAL_INPUT + "font-family: monospace;").classes('w-full bg-gray-50')
            
            # ç®€å•å‚æ•°å®šä¹‰ (æš‚æ—¶ç”¨æ–‡æœ¬è§£æï¼Œç®€åŒ–æ“ä½œ)
            # å®é™…å¯ä»¥åšæ›´å¤æ‚çš„è¡¨æ ¼
            ui.label('PARAMS (Format: name,label,default)').classes('font-bold mt-2 text-xs')
            
            # è¾…åŠ©å‡½æ•°ï¼šæŠŠparamsåˆ—è¡¨è½¬æˆå­—ç¬¦ä¸²æ˜¾ç¤º
            def params_to_str(plist):
                return "\n".join([f"{p['name']},{p.get('label','')},{p.get('default','')}" for p in plist])
            
            # è¾…åŠ©å‡½æ•°ï¼šæŠŠå­—ç¬¦ä¸²è½¬å›paramsåˆ—è¡¨
            def str_to_params(text):
                plist = []
                for line in text.split('\n'):
                    parts = line.split(',')
                    if len(parts) >= 1 and parts[0].strip():
                        plist.append({
                            "name": parts[0].strip(),
                            "label": parts[1].strip() if len(parts)>1 else parts[0],
                            "default": parts[2].strip() if len(parts)>2 else "",
                            "type": "text"
                        })
                return plist

            current_params_str = params_to_str(data.get('params', []))
            params_input = ui.textarea(value=current_params_str).props('outlined dense placeholder="ip,Target IP,127.0.0.1"').style(theme.BRUTAL_INPUT).classes('w-full h-24')

        # åº•éƒ¨æ 
        with ui.row().classes('p-4 w-full justify-end bg-gray-100 border-t-2 border-black'):
            if is_edit:
                # åˆ é™¤æŒ‰é’®
                def delete_curr():
                    db.delete_template(tid)
                    render_grid.refresh()
                    dialog.close()
                    ui.notify('DELETED', color='red')
                ui.button('DELETE', on_click=delete_curr).props('flat color=red').classes('mr-auto')

            def save():
                if not name.value: return ui.notify('Name required', color='red')
                
                save_id = tid if is_edit else str(uuid.uuid4())[:8]
                new_data = {
                    "name": name.value,
                    "desc": desc.value,
                    "template": code.value,
                    "params": str_to_params(params_input.value),
                    "tags": data.get('tags', []) # æš‚æ—¶ä¿ç•™æ—§tags
                }
                db.save_template(save_id, new_data)
                render_grid.refresh()
                dialog.close()
                ui.notify('SAVED', type='positive', color='black')

            brutal_button('SAVE CHANGES', color=theme.PRIMARY, on_click=save).classes('text-white')

    dialog.open()

# --- è¿è¡Œå™¨å¼¹çª— ---
def open_runner(tid):
    data = db.get_templates().get(tid)
    if not data: return

    with ui.dialog() as dialog, ui.card().style(theme.BRUTAL_CARD + "min-width: 500px; padding: 0;"):
        with ui.row().classes('w-full bg-yellow-400 p-4 border-b-2 border-black items-center justify-between'):
            ui.label(f">> RUN: {data['name']}").classes('font-mono font-black text-xl')
            ui.icon('terminal', size='sm')

        inputs = {}
        with ui.column().classes('p-6 w-full gap-4'):
            for p in data.get('params', []):
                inputs[p['name']] = ui.input(p.get('label', p['name']), value=p.get('default', '')) \
                    .props('outlined dense').style(theme.BRUTAL_INPUT).classes('w-full')
            
            res_area = ui.code('READY_TO_GENERATE...').classes('w-full p-4 border-2 border-black bg-black text-green-400 font-mono rounded')

            def run():
                try:
                    pvals = {k: v.value for k,v in inputs.items()}
                    cmd = db.render_command(data.get('template',''), pvals)
                    res_area.content = cmd
                    ui.clipboard.write(cmd)
                    ui.notify('COPIED TO CLIPBOARD', color='black')
                except Exception as e:
                    ui.notify(str(e), color='red')
            
            brutal_button('GENERATE & COPY', icon='bolt', color=theme.ACCENT_TEAL, on_click=run).classes('w-full mt-2')

    dialog.open()

ui.run(title="CMD_NEXUS", native=True, window_size=(1000, 800), reload=False)

ğŸš€ å¯åŠ¨æŒ‡å—
 * ä¿å­˜è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚
 * ç¡®ä¿ logic.py è¿˜åœ¨ï¼ˆå¦‚æœä¸åœ¨äº†å°±ç”¨ä¸Šä¸€æ¡å›å¤é‡Œçš„ï¼‰ã€‚
 * è¿è¡Œï¼š
   python main.py

ä½ åº”è¯¥ä¼šçœ‹åˆ°ï¼š
 * ç™½åº•é»‘è¾¹çš„ç¡¬æœ—ç•Œé¢ã€‚
 * èƒŒæ™¯æœ‰ç‚¹é˜µçº¹ç†ã€‚
 * æŒ‰é’®æ˜¯äº®é»„è‰²ã€äº®ç´«è‰²ï¼Œè€Œä¸”æœ‰ç²—é»‘çš„è¾¹æ¡†ã€‚
 * ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œå®ƒä¼šçœŸçš„**â€œæŒ‰ä¸‹å»â€**ï¼ˆæ¶ˆå¤±æ‰é˜´å½±ï¼Œä½ç§»ï¼‰ã€‚
 * å·¦ä¸Šè§’çš„ LOGO åƒæ˜¯è´´çº¸ä¸€æ ·æ‹¼æ¥çš„ã€‚
è¿™å¥—ç•Œé¢æ—¢æœ‰**â€œå·¥ä¸šæœ‹å…‹â€çš„ç²—ç³™æ„Ÿï¼Œåˆç¬¦åˆç°ä»£å®¡ç¾çš„â€œæ–°æ½®â€**æ„Ÿï¼Œè€Œä¸”æ“ä½œé€»è¾‘éå¸¸æ¸…æ™°ï¼ˆæ‰€è§å³æ‰€å¾—ï¼‰ã€‚
å¿«å»è¯•è¯•ï¼Œæ–°å»ºå‡ ä¸ªå‘½ä»¤ï¼Œå¡«å…¥ï¼š
 * Name: Deploy to Prod
 * Params: version,Image Version,v1.0.0 (æ³¨æ„è¿™è¡Œçš„æ ¼å¼ï¼šè‹±æ–‡å,ä¸­æ–‡å,é»˜è®¤å€¼)
 * Template: docker run my-app:{{ version }}
çœ‹çœ‹é‚£ä¸ªå¡ç‰‡å’Œå¼¹çª—çš„æ•ˆæœï¼Œæ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿ
